Elektronische Gesundheitskarte und Telematikinfrastruktur

Spezifikation ePA-Frontend des Versicherten

{include-macros:/macros.gematikMacros}#renderGematikDokumentenTitel($document)

## Dokumenteninformation

Änderungen zur Vorversion

Anpassungen des vorliegenden Dokumentes im Vergleich zur Vorversion können Sie der nachfolgenden Tabelle entnehmen.

Dokumentenhistorie

|=========================================================================================================================|
|Version      |Stand         |Kap./ Seite|Grund der Änderung, besondere Hinweise                    |Bearbeitung          |
|=============|==============|===========|==========================================================|=====================|
|1.0.0        |18.12.18      |           |Erstversion                                               |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.1.0        |15.05.19      |           |Einarbeitung P18.1                                        |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.2.0        |28.06.19      |           |Einarbeitung P19.1                                        |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.3.0        |02.10.19      |           |Einarbeitung P20.1/2                                      |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.4.0        |02.03.20      |           |Einarbeitung P21.1                                        |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.5.0        |27.03.20      |           |Einarbeitung P21.2                                        |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.5.1        |26.06.20      |           |Einarbeitung P21.3                                        |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.6.0        |30.06.20      |           |Anpassungen gemäß Änderungsliste P22.1 und Scope-Themen   |gematik              |
|             |              |           |aus Systemdesign R4.0.0                                   |                     |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.7.0        |12.11.20      |           |Einarbeitung Scope-Themen, PDSG-Änderungen                |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.8.0        |19.02.21      |           |Einarbeitung Änderungsliste P22.5                         |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.9.0        |02.06.21      |           |Einarbeitung ePA_Maintenance_21.1 und Featurspezifikation |gematik              |
|             |              |           |gemF_ePA_stat_FdV                                         |                     |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.10.0       |09.07.21      |           |Einarbeitung Anpassung IOP-WS (ePA_Maintenance_21.2)      |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.10.1       |30.09.21      |           |Einarbeitung ePA_Maintenance_21.3                         |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.11.0       |31.01.22      |           |Einarbeitung ePA_Maintenance_21.4 und ePA_Maintenance_21.5|gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.11.1       |31.03.22      |           |Einarbeitung Änderungsliste ePA_Maintenance_22.1          |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.50.0       |06.04.22      |           |ePA-Stufe 2.5: gemF_ePA_DiGA_Anbindung,                   |gematik              |
|             |              |           |gemF_ePA_FDZ_Anbindung und  gemF_ePA_Gesundheitsportal    |                     |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.50.1       |23.05.22      |           |Einarbeitung Kommentierung                                |gematik              |
|-------------|--------------|-----------|----------------------------------------------------------|---------------------|
|1.51.0       |25.07.22      |           |Änderungsliste ePA_Maintenance_22.2, redaktionell:        |gematik              |
|             |              |           |diskriminierungsfreie Sprache (Black-/Whitelist in Deny-  |                     |
|             |              |           |/Allowlist)                                               |                     |
|=========================================================================================================================|

## Inhaltsverzeichnis

## 1 Einordnung des Dokumentes

## 1.1 Zielsetzung

Die vorliegende Spezifikation definiert die Anforderungen zu Herstellung, Test und Betrieb des Produkttyps ePA-Frontend
des Versicherten.

## 1.2 Zielgruppe

Das Dokument richtet sich an Hersteller von Produkten des Frontend des Versicherten sowie an Hersteller und Anbieter von
weiteren Produkttypen der Fachanwendung ePA.

## 1.3 Geltungsbereich

Dieses Dokument enthält normative Festlegungen zur Telematikinfrastruktur des deutschen Gesundheitswesens. Der
Gültigkeitszeitraum der vorliegenden Version und deren Anwendung in Zulassungs- oder Abnahmeverfahren wird durch die
gematik GmbH in gesonderten Dokumenten (z.B. Dokumentenlandkarte, Produkttypsteckbrief, Leistungsbeschreibung)
festgelegt und bekannt gegeben.

Schutzrechts-/Patentrechtshinweis

Die nachfolgende Spezifikation ist von der gematik allein unter technischen Gesichtspunkten erstellt worden. Im
Einzelfall kann nicht ausgeschlossen werden, dass die Implementierung der Spezifikation in technische Schutzrechte
Dritter eingreift. Es ist allein Sache des Anbieters oder Herstellers, durch geeignete Maßnahmen dafür Sorge zu tragen,
dass von ihm aufgrund der Spezifikation angebotene Produkte und/oder Leistungen nicht gegen Schutzrechte Dritter
verstoßen und sich ggf. die erforderlichen Erlaubnisse/Lizenzen von den betroffenen Schutzrechtsinhabern einzuholen. Die
gematik GmbH übernimmt insofern keinerlei Gewährleistungen.

## 1.4 Abgrenzungen

Im Dokument wird spezifiziert, wie Schnittstellen benutzt werden, um fachliche Anwendungsfälle umzusetzen. Die
Schnittstellen selbst werden in der Spezifikation desjenigen Produkttypen beschrieben, der die Schnittstelle
bereitstellt. Auf die entsprechenden Dokumente wird referenziert (siehe auch Anhang 9.5).

Die vollständige Anforderungslage für den Produkttyp ergibt sich aus weiteren Konzept- und Spezifikationsdokumenten.
Diese sind in dem Produkttypsteckbrief des Produkttyps ePA-Frontend des Versicherten verzeichnet.

## 1.5 Methodik

Anforderungen als Ausdruck normativer Festlegungen werden durch eine eindeutige ID sowie die dem RFC 2119 [RFC2119]
entsprechenden, in Großbuchstaben geschriebenen deutschen Schlüsselworte MUSS, DARF NICHT, SOLL, SOLL NICHT, KANN
gekennzeichnet.

Sie werden im Dokument wie folgt dargestellt:<br>
<AFO-ID> - <Titel der Afo><br>
Text / Beschreibung<br>
[<=]

Dabei umfasst die Anforderung sämtliche zwischen Afo-ID und der Textmarke [<=] angeführten Inhalte.

Die Spezifikation der durch den Produkttyp genutzten Interfaces erfolgt in der Spezifikation des Produkttypen, welcher
das Interface anbietet. Eine Übersicht befindet sich in Kapitel "".

## 2 Systemüberblick

Das ePA-Frontend des Versicherten (FdV) ist eine Anwendung, welche die für die Nutzung der ePA notwendigen
Funktionalitäten bündelt und dezentrale Fachlogik der Fachanwendung ePA ausführt. Das FdV ermöglicht es Versicherten,
ePA-Anwendungsfälle auszuführen.

Ausführungsumgebung des FdV ist ein Gerät des Versicherten (GdV), bspw. ein stationäres Gerät oder ein mobiles Endgerät.
Es steht unter alleiniger Kontrolle des Versicherten. Dem Versicherten obliegt es, durch geeignete Maßnahmen die
Sicherheit der Daten zu stärken.

Das FdV kann zusätzliche Funktionalitäten anbieten, die nicht der Fachanwendung ePA zugeordnet werden und somit nicht
der Regelungshoheit der gematik unterliegen.

## 3 Systemkontext

## 3.1 Akteure und Rollen

Im Systemkontext des FdV interagieren verschiedene Akteure (aktive Komponenten) in unterschiedlichen Rollen mit dem FdV.

Tabelle #: TAB_FdV_101 – Akteure und Rollen

|=======================================================================================================================|
|Akteur                      |Rolle                                 |Beschreibung                                       |
|============================|======================================|===================================================|
|Nutzer des FdV              |Versicherter (als Aktenkontoinhaber)  |Primärer Anwender, Ausführen von fachlichen        |
|                            |oder <br>Vertreter eines Versicherten |Anwendungsfällen mit Zugriff auf ein ePA-          |
|                            |                                      |Aktensystem                                        |
|----------------------------|--------------------------------------|---------------------------------------------------|
|Ausführungsumgebung         |Gerät des Versicherten                |Betriebs-/Ablaufumgebung des FdV                   |
|----------------------------|--------------------------------------|---------------------------------------------------|
|Kartenleser                 |Gerät des Versicherten                |Ermöglicht dem ePA-Frontend des Versicherten den   |
|                            |                                      |Zugriff auf die eGK des Nutzers. Es kann die       |
|                            |                                      |kontaktbehaftete oder die kontaktlose Schnittstelle|
|                            |                                      |der eGK genutzt werden.                            |
|----------------------------|--------------------------------------|---------------------------------------------------|
|Anbieter ePA-Aktensystem    |Organisatorisch, kein Akteur in der   |Der Anbieter stellt Informationen bereit, um sich  |
|                            |Ausführung von ePA-Anwendungsfällen   |via FdV am ePA-Aktensystem anzumelden.             |
|----------------------------|--------------------------------------|---------------------------------------------------|
|Hersteller ePA-Frontend des |Organisatorisch, kein Akteur in der   |Der Hersteller FdV stellt im Handbuch Informationen|
|Versicherten                |Ausführung von ePA-Anwendungsfällen   |bereit bezüglich<br>        Anforderungen an die   |
|                            |                                      |Ausführungsumgebung       Möglichkeiten zur        |
|                            |                                      |Anbindung der eGK  Der Hersteller FdV erfüllt      |
|                            |                                      |sicherheitstechnische Anforderungen zum            |
|                            |                                      |Herstellungsprozess.                               |
|=======================================================================================================================|

## 3.2 Nachbarsysteme

Die vom FdV direkt erreichbaren Produkttypen der TI sind

   - ePA-Aktensystem,
   - Signaturdienst und
   - eGK (G2 und höher).

![img](7913055270935262241.]

Abbildung #: Systemüberblick FdV

Der Signaturdienst bietet die Schnittstelle I_Remote_Sign_Operations für Signaturen mittels der alternativen
kryptographischen Versichertenidentität an. Siehe [gemSpec_SigD].

In TAB_FdV_102 sind die Schnittstellen des ePA-Aktensystems gelistet, welche durch das ePA-Frontend des Versicherten
genutzt werden.

Tabelle #: TAB_FdV_102 – Schnittstellen des ePA-Aktensystems

|=======================================================================================================================|
|Schnittstelle                       |Operationen                         |Bemerkung                                    |
|====================================|====================================|=============================================|
|I_Authentication_Insurant           |getAuditEvents<br>                  |Definition in [gemSpec_Authentisierung_Vers] |
|                                    |LoginCreateChallenge<br>            |                                             |
|                                    |LoginCreateToken<br>LogoutToken<br> |                                             |
|                                    |RenewToken                          |                                             |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Authorization_Insurant            |getAuthorizationKey                 |Definition in [gemSpec_Autorisierung]        |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Authorization_Management_Insurant |deleteAuthorizationKey<br>          |Definition in [gemSpec_Autorisierung]        |
|                                    |getAuditEvents<br>                  |                                             |
|                                    |getAuthorizationList<br>            |                                             |
|                                    |putAuthorizationKey<br>             |                                             |
|                                    |putNotificationInfo<br>             |                                             |
|                                    |getNotificationInfo<br>             |                                             |
|                                    |replaceAuthorizationKey             |                                             |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Account_Management_Insurant       |GetAuditEvents<br>SuspendAccount<br>|Definition in [gemSpec_Dokumentenverwaltung] |
|                                    |ResumeAccount                       |                                             |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Proxy_Directory_Query             |Search                              |Definition in [gemSpec_Zugangsgateway_Vers]  |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Document_Management_Connect       |CloseContext<br>OpenContext         |Definition in [gemSpec_Dokumentenverwaltung] |
|------------------------------------|------------------------------------|---------------------------------------------|
|I_Document_Management_Insurant      |ProvideAndRegisterDocumentSet-b<br> |Definition in [gemSpec_Dokumentenverwaltung] |
|                                    |RegistryStoredQuery<br>             |                                             |
|                                    |RemoveMetadata<br>                  |                                             |
|                                    |RetrieveDocumentSet<br>             |                                             |
|                                    |RestrictedUpdateDocumentSet         |                                             |
|------------------------------------|------------------------------------|---------------------------------------------|
|Status-Proxy                        |                                    |Definition in [gemSpec_Zugangsgateway_Vers]  |
|------------------------------------|------------------------------------|---------------------------------------------|
|TSL-Proxy                           |                                    |Definition in [gemSpec_Zugangsgateway_Vers]  |
|------------------------------------|------------------------------------|---------------------------------------------|
|Schlüsselgenerierungsdienst Typ 1   |                                    |Definition in [gemSpec_SGD_ePA]              |
|und Typ 2                           |                                    |                                             |
|=======================================================================================================================|

Für die Authentisierung mittels eGK und kryptographischer Operationen greift das ePA-Frontend des Versicherten über ein
Kartenlesegerät oder über die kontaktlose Schnittstelle auf die eGK zu.

## 3.2.1 Identität des Nutzers

Ein Versicherter kann als Nutzer des FdV das auf der eGK verfügbare Schlüsselmaterial und Zertifikate für die
Authentisierung gegenüber dem ePA-Aktensystem und dem Schlüsselgenerierungsdienst verwenden.

Voraussetzung ist die Nutzung einer eGK G2 oder höher, wobei eine eGK G2 nur den RSA-2048-Algorithmenkatalog
unterstützt. Eine eGK G2.1 unterstützt den RSA-2048 und ECC-256-Algorithmenkatalog. Die normierenden Organisationen
haben das Ende der Zulässigkeit für den RSA-2048 festgelegt. Aus diesem Grund wird bei Nutzung einer eGK G2 der RSA-
Algorithmenkatalog und bei eGK einer höheren Generation (d.h. ab eGK G2.1) der ECC-Algorithmenkatalog verwendet.

Zusätzlich zur eGK sieht das FdV die Möglichkeit der Nutzung einer alternativen Authentisierung vor. Sie muss bei der
Krankenkasse des Nutzers beantragt werden. Die Authentisierung beim ePA-Aktensystem erfolgt unter Einbeziehung eines
Signaturdienstes.

Für die Zertifikate der alternativen Authentisierung wird der ECC-Algorithmenkatalog verwendet.

## 4 Zerlegung des Produkttyps

Im Folgenden wird die Zerlegung des Produkttyps ePA-Frontend des Versicherten dargestellt, welche für die Übersicht der
funktionalen Leistungsmerkmale in der vorliegenden Spezifikation nötig ist.

![img](9794005180881397695.]

Abbildung #: Komponenten ePA-Frontend des Versicherten

Tabelle #: TAB_FdV_167 – Komponenten des FdV

|========================================================================================================================|
|Komponente             |Verantwortung und Funktionalität                                              |Spezifiziert in  |
|=======================|==============================================================================|=================|
|Fachlogik              |Die Komponente steuert die Anwendungsfälle entsprechend den                   |Kap. 6.2         |
|                       |fachanwendungsspezifischen Festlegungen.                                      |                 |
|-----------------------|------------------------------------------------------------------------------|-----------------|
|Plattformbausteine     |Diese Komponente enthält Plattformbausteine, welche Funktionalitäten der TI-  |Kap. 6.3         |
|                       |Plattform zur Verfügung stellen:<br> Zugriff auf die eGK für kryptografische  |                 |
|                       |Operationen, PIN-Management, ...       Kryptografische Operationen Die        |                 |
|                       |Plattformbausteine werden durch die Fachlogik angesteuert.                    |                 |
|========================================================================================================================|

Das für die Nutzung des ePA-Frontend des Versicherten notwendige GUI ist Teil des FdV und wird nicht normativ durch die
Spezifikation des FdV vorgegeben.

Das FdV kann zusätzliche Funktionen beinhalten, bspw. kassenspezifische Funktionen, welche Schnittstellen zu
kassenspezifischen Diensten außerhalb der TI nutzen.

Das ePA-Frontend des Versicherten besitzt eine produktspezifische anwendungsinterne Schnittstelle, welche durch das GUI
oder die zusätzlichen Funktionalitäten der integrierenden Anwendung genutzt werden kann, um ePA-Anwendungsfälle
auszuführen.

## 5 Übergreifende Festlegungen

Das ehemalige ePA-Modul FdV wurde als eigenständiges Objekt der Produktzulassung vollständig abgelöst vom ePA-Frontend
des Versicherten (also der Gesamt-App). Das sollte durch die Verfahrensbeschreibung und den Aufbau sowie die Bezeichnung
des Produkttypsteckbriefs eindeutig und normativ dargestellt sein. Das heißt, prinzipiell richten sich alle
Anforderungen des Produkttypsteckbriefs an die gesamte ePA-App bzw. an deren Entwicklungsprozess. Der Nachweis zur
Erfüllung der Anforderungen erfolgt dabei im Einzelnen folgendermaßen:

   -  Die Menge der Anforderungen zur funktionalen Eignung, deren Erfüllung im Produkttest bzw. Produktübergreifenden
     Test nachzuweisen ist, entspricht weitgehend der die ursprünglich dem ehemaligen ePA-Modul zugeordnet war. Es
     handelt sich um die Vorgaben an die Funktionalität für den Zugriff auf die ePA (die Komponenten der TI). Der Test
     erfolgt, unverändert zum bisher geplanten Vorgehen, unter Einsatz des AKTORs und der Testtreiberschnittstelle.
   - Die Menge der Anforderungen zur funktionalen Eignung, deren Erfüllung durch Herstellererklärung zu belegen ist,
     umfasst nunmehr auch Anforderungen, die bisher nur mittelbar durch das Verfahren der Bestätigung der
     Entwicklungsprozesse an die gesamte App gestellt wurden. Dabei handelt es sich beispielsweise um elementare
     Anforderungen an die Nutzerinteraktion (Anzeige etc.), die nicht unter Nutzung des AKTORs geprüft werden
     können/sollen.
   - Die Anforderungen der sicherheitstechnischen Eignung, deren Erfüllung im Produktgutachten bzw. in der CC-
     Evaluierung nachzuweisen ist, richten sich an die gesamte App – der Betrachtungsgegenstand der Prüfung ist die
     gesamte App einschließlich der von der gematik nicht spezifizierten Funktionalität.
   - Die Herstellererklärung zur sicherheitstechnischen Eignung bezieht sich auf die Erfüllung von Anforderungen an die
     gesamte App.
   - Die Anforderungen zur Sicherheitsbegutachtung entsprechen denen, die nach dem bisherigen Verfahren in der
     Bestätigung der sicheren Entwicklungsprozesse des Herstellers nachgewiesen wurden. 

Die Gesamtmenge der Anforderungen, die sich aus der Zusammenführung der Produktzulassung und der Bestätigung der
Entwicklungsprozesse des Herstellers ergibt, ist im Wesentlichen unverändert geblieben. 

Die Darstellung in der Systemlösung hat keinen normativen Charakter, was den Schnitt der Zulassungsobjekte und deren
inneren Aufbau betrifft.

## 5.1 Datenschutz und Sicherheit

In diesem Kapitel werden übergreifende Anforderungen beschrieben, die sich aus den Themenfeldern Datenschutz und
Sicherheit ergeben.

Hinweis: Der auszuführende Code für die ePA-Funktionen des ePA-FdV muss lokal vorliegen und ausgeführt werden, so dass
insbesondere alle ePA-Daten (medizinische Daten, sicherheitskritische Daten wie Schlüssel) ausschließlich lokal
verarbeitet werden. Zudem erschwert es Administratoren von Servern, auf denen der Code liegen könnte, den Code zu
manipulieren.

Dies bedeutet insbesondere, dass eine Auslagerung von ePA-Funktionen auf Webserver nicht erlaubt ist. Dies verhindert
jedoch nicht, das ePA-FdV mithilfe von Webtechnologien umzusetzen, um eine Plattformunabhängigkeit zu erreichen.
Mithilfe des Frameworks Electron können beispielsweise in HTML, CSS und JavaScript entwickelte Anwendungen lokal
unabhängig vom verwendeten Betriebssystem (Windows, MacOS, Linux) ausgeführt werden. Electron bietet auch die
Möglichkeit der Nutzung von WebAssembly.

Die Annahmen und Anforderungen sollen insbesondere Hinweise enthalten, mit welchen Maßnahmen der Nutzer seine
Ausführungsumgebung sicher gestalten kann.

Die medizinischen Dokumente im ePA-Aktensystem sind Ende-zu-Ende verschlüsselt. Dadurch können die Dokumente nicht an
zentraler Stelle auf mögliche Schadsoftware geprüft werden. Eine Absicherung gegen mögliche Schadsoftware muss auf dem
GdV erfolgen.

Hinweis: Die Anforderung A_20211-* und A_21354 legen die Bedingungen für die persistente Speicherung von
Authentisierungsmerkmalen fest.

Der Umfang der Session-Daten ist im Kapitel "" beschrieben. Die für den Versicherten im Aktenkonto bereitgestellten
Dokumente gehören nicht zu den Session-Daten.

Hinweis: Dies ist die analoge Anforderung zu A_20211-* bei mobilen Endgeräten.

Hinweis: Eine explizite Authentifizierung des Versicherten durch das ePA-FdV wird empfohlen.

Hinweis: Für die Authentifizierung des Nutzers am ePA-FdV können die Authentifizierungsfunktionen des Betriebssystems
des Endgerätes (z.B. Logscreen-Credentials, Biometrie) genutzt werden. Bei der Authentifizierung der oberen Anforderung
ist nicht die Anmeldung an Backendsystemen (z.B. ePA-Aktensystem) gemeint, sondern die Authentifizierung am ePA-Frontend
des Versicherten.

Dies betrifft bspw. die folgenden Aspekte:

   - Schutz von Reverse Engineering
   - Verwendung von Plattform Sicherheit Best Practice
   - Secure Data Storage
   - Schutz gegen code tampering
   - Extraneous functionality

Für mobile Anwendungen sind OWASP Top Ten Mobile Controls [OWASP TTMC] und OWASP MASVS – L2 + R [OWASP MASVS] zu
beachten. Anforderung A_15255-01 ist sowohl für Lösungen auf mobilen als auch Desktop-Plattformen umzusetzen.

Die im Aktenkonto eingestellten Dokumente werden verschlüsselt an das Aktensystem übermittelt und verarbeitet. Sie
liegen im Aktensystem nie im Klartext vor. Daher kann das ePA-Aktensystem den Inhalt der Dokumente nicht auf
Schadsoftware überprüfen.

Folgende Maßnahmen sind sinnvoll:

   - Prüfen, ob Dokumenten-Format und Inhalt mit dem angegebenen Dokumententyp in den Metadaten übereinstimmt
   - Prüfen, ob Dokumenten-Format und Inhalt zu den erlaubten ePA-Dokumentenformaten passt
   - Vor der Anzeige eines Dokumentes sind Sonder- und Meta-Zeichen im Dokument für die jeweilige Anzeigesoftware mit
     der richtigen Escape-Syntax zu entschärfen.
   - Die Anzeigesoftware ist in einer Art Sandbox zu betreiben.

Im Folgenden wird unter Tracking Usability-Tracking sowie Crash-Reporting verstanden.

Hinweis: Sicherheitsmerkmale sind die Gerätekennung (DeviceID) und Session-Daten wie z.B. geheime oder private
Schlüssel, Authentifizierungs- oder Autorisierungsbestätigungen.

Hinweis: Personenbezogene Daten mit direktem Personenbezug sind bspw. Namen von natürlichen Personen, Geräte-IDs,
Nutzerkennungen oder ein „Fingerabdruck“ auf Basis von Geräteeigenschaften und Einstellungen.

Tracking Anforderungen für Trackingdaten ohne Einwilligung

Hinweis: Andere Quellen sind z.B. Webtracker, Tracker von anderen Apps oder Trackingmerkmale des Betriebssystems (z.B.
Hardware IDs, Network IDs oder Advertising IDs).  

Hinweis: Diese Anforderung ist nicht durch einen alleinigen Verweis auf die AGB oder Nutzungsbedingungen des FdVs
erfüllbar. Verständliche Form bedeutet eine kurze nicht juristische Erklärung zum Zweck des Trackings. Leicht
zugängliche Form bedeutet direkt im FdV.

Anforderungen zur Einwilligung zum Session-übergreifenden Tracking

Hinweis: Das FdV muss voll-funktional ohne aktiviertes Tracking nutzbar sein.

Hinweis: Diese Anforderung ist nicht durch einen alleinigen Verweis auf die AGB oder Nutzungsbedingungen des FdVs
erfüllbar. Verständliche Form bedeutet eine kurze nicht juristische Erklärung zum Zweck des Trackings. Leicht
zugängliche Form bedeutet direkt im FdV.

Hinweis: Wenn der Benutzer seine Einwilligung zum Tracking nicht erteilt, darf das FdV den Nutzer nicht solange nach
seiner Einwilligung fragen, bis der Nutzer diese erteilt.

Wenn die eGK zur Verfügung steht, dann kann diese für das Erzeugen von Schlüsseln in der geforderten Qualität
(Kartenkommando GET RANDOM) genutzt werden. Ist das optionale Kartenkommando GET RANDOM für die eGK nicht verfügbar
(Fehlermeldung der Karte), dann kann das Kartenkommando GET CHALLENGE (PL_TUC_GET_CHALLENGE) der eGK genutzt werden. GET
RANDOM und GET CHALLENGE liefern einen ausreichend guten Zufall, der die Forderungen aus [gemSpec_Krypt#GS-A_4368]
erfüllt.

Wenn die eGK nicht zur Verfügung steht, dann können Informationen von zusätzliche Quellen (Internet, Sensoren des GdV)
zusammengeführt werden, um die geforderte Entropie zu erreichen.

Bspw. ist ein Opt-In anstelle eines Opt-Out-Verfahrens anzuwenden.

Hinweis:  Beispielmaßnahmen sind in [OWASP Proactive Control#C2] zu finden. Das gewählte Verfahren muss die gleiche
Wirksamkeit aufweisen, wie die Kapselung gemäß [OWASP Proactive Control#C2 Punkt 4].

Das ePA-Frontend des Versicherten bietet nur Funktionalitäten an, welche sich aus den Anwendungsfällen der Fachanwendung
ePA ergeben. 

Zusätzliche Funktionalitäten können durch das FdV angeboten werden. Folgende Anforderungen gelten für die Abgrenzung der
zusätzlichen Funktionalitäten zu denen der Fachanwendung ePA.

Die Information, welche Funktionalitäten zusätzlich zu den Funktionen für die ePA enthalten und damit nicht Gegenstand
der Zulassung durch die gematik sind, kann im Handbuch oder den Informationen zur Zustimmung gemäß A_16439 beschrieben
werden.

Die in A_16439 geforderte Zustimmung kann einmalig durch den Versicherten erteilt werden und bis auf Widerruf des
Versicherten für alle Datenweiterleitungen, die von dem Versicherten veranlasst werden, gelten. Das FdV kann dabei die
Möglichkeit einer expliziten Opt-in-Lösung mit Widerrufsrecht oder ein anlassbezogenes Zustimmungsverfahren oder eine
Wahlmöglichkeit beider Verfahren vorsehen.

Hinweis: Die A_20721 setzt die Forderung des § 345 Abs. 1 SGB V um. Die Einwilligung gegenüber der Krankenkasse kann
elektronisch erfolgen. Dies betrifft insbesondere auch die Übermittlung des Nachweises, mit dem die Krankenkasse die
Einwilligung des Versicherten in die Verarbeitung der Daten nachweisen kann (vgl. Art. 7 Abs. 1 DSGVO).

Hinweis: Im Gegensatz zu Betriebssystem für Smartphones und Tablets wie etwa Android und iOS sind Betriebssysteme für
stationäre Geräte wie etwa PCs durchaus im öffentlichen Raum verfügbar. So läuft etwa auf den meisten Geräten in
Internet-Cafes Windows. Würde hier das ePA-FdV ausgeführt werden und der Versicherte sich Dokumente aus seiner Akte
herunterladen, dann müsste der Versicherte dafür sorgen, dass keine Daten von ihm auf der Hardware verbleiben, wenn er
den Zugriff auf die Hardware beendet. Es wird empfohlen, die Nutzung des ePA-FdV auf öffentlich zugänglicher Hardware zu
unterlassen.

Hinweis: Die einmalige Anzeige des Hinweises mit Bestätigung pro Versicherten ist ausreichend. Es muss dabei
sichergestellt sein, dass jedem Nutzer (Mehrbenutzerbetrieb) dieser Hinweis zur Bestätigung angezeigt wird. Dieses
könnte etwa durch Anzeige vor der Authentisierung gegenüber dem ePA-FdV erfolgen.

Hinweis: Die Anforderung soll das Einschleusen von Schadcode verhindern. Dies kann beispielsweise durch Signieren des
ePA-FdV durch den Hersteller erfolgen, um Manipulationen am ePA-FdV vor der Ausführung erkennen zu können. Das Verbot
des dynamischen Nachladens von ungeprüftem Code soll insbesondere auch sicherstellen, dass zum Zeitpunkt der Prüfung des
ePA-FdV durch den Produktgutachter der gesamte Anwendungscode vorliegt und dieser nicht später durch ungeprüften Code
ersetzt bzw. ergänzt werden kann.

Im Zulassungsverfahren für das ePA-FdV ist festgelegt, wann Änderungen durch die gematik als zulassungsrelevant
betrachtet werden. Zulassungsrelevante Änderungen sind z.B. Änderungen von Sicherheitsfunktionen oder deren
Implementierung (z.B. Wechsel der TLS-Implementierung). Nicht-zulassungsrelevante Änderungen sind z.B.
Sicherheitsupdates für von anderen Herstellern bezogenen Software-Komponenten der Plattform (z.B. Bibliotheken), die aus
einer vertrauenswürdigen Quelle bezogen werden.

Hinweis: Nach A_20746 muss sich der Nutzer beim Starten des ePA-FdV am ePA-FdV authentisieren.

Hinweis: Krankenkassen (als Anbieter eines ePA-Aktensystems) können zur Umsetzung dieser Anforderung z.B. den
Versicherten hierzu entsprechendes Informationsmaterial zur Verfügung stellen, wo die Download-Punkte aufgelistet sind.

Hinweis: Beim Erstbezug des ePA-FdV kann die Prüfung der Authentizität der Quelle noch nicht durch das ePA-FdV selbst
erfolgen. Dies kann z.B. über eine TLS-Server-Authentifizierung der Bezugsquelle erreicht werden. Bei ePA-FdVs in den
Stores der mobilen Plattformen kann der Versicherte die Vertrauenswürdigkeit daran erkennen, dass er den offiziellen
Store nutzt. Auch unter Windows und Mac OS und Linux/Debian gibt es einen offiziellen Store.

Hinweis: Die Zustimmung kann einmal eingeholt werden und muss nicht bei jedem Zugriff wiederholt erfolgen.

## 5.1.1 Anforderungen zum Herstellungsprozess

Hinweis: Das Sicherheitskonzept soll zwingend die folgenden Punkte umfassen: 

   - Beschreibung des ePA-Frontends des Versicherten und Einbindung zusätzlicher Funktionalitäten vom Hersteller bzgl.
     allgemeiner Informationssicherheitsaspekte und Sicherheitsanforderungen der  gematik, 
   - Schutzbedarfsfeststellung,
   - Bedrohungsanalyse,
   - Sicherheitsanalyse (Verifikation der Wirksamkeit der Sicherheitsmaßnahmen), 
   - Erstellung einer Restrisikoabschätzung. 

Hinweis: Das Datenschutzkonzept soll zwingend die folgenden Punkte umfassen: 

   - Beschreibung des ePA-Frontends des Versicherten (inklusiv zusätzliche Funktionalität vom Hersteller) bzgl.
     Datenschutzaspekte
   - Identifikation der Randbedingungen des Datenschutzes
   - Identifikation der personenbezogenen Daten und Anwendungsprozesse
   - Umsetzung der Grundsätze für die Verarbeitung personenbezogener Daten - Datenschutz-Risiken und Datenschutz-
     Hinweise

Hinweis: Der Testplan umfasst alle Sicherheitstests während den Phasen der Produktentwicklung sowie regelmäßige
Sicherheitsprüfungen (Pentest) durch unabhängige Sicherheitsexperten. Der Umfang des Testplans hängt von der
Zielplattform <br>
sowie den Funktionalitäten des ePA-Frontends des Versicherten ab und muss zwingend das Testvorgehen zu den
Sicherheitsvorgaben der gematik beinhalten.

Orientierungen zu den Inhalten eines Testplanes sind im OWASP Mobile Security Testing Guide [MSTG] und im OWASP Mobile
Application Security Verification Standard [MASVS] beschrieben. Der Testplan muss einen ähnlichen Detaillierungsgrad 
<br>
haben, wie in den beiden OWASP-Referenzen.

Hinweis: Der Testbericht muss zwingend Testauswertungen zu den Sicherheitsvorgaben der gematik beinhalten.

Ein Beispiel für Sicherheitsaktivitäten in einem Produktlebenszyklus ist der Microsoft Security Development Lifecycle.
Für weitere Informationen siehe [OWASP SAMM Project] oder den durch das BSI bereitgestellte "Leitfaden zur Entwicklung
sicherer Webanwendungen - Empfehlungen und Anforderungen an die Auftragnehmer" (insbesondere Kapitel 4). Als ein
Hilfsmittel bietet die gematik eine informative SDL Orientierungshilfe an, die Hersteller sowie Sicherheitsgutachter
unterstützt, um einen SDL zu etablieren oder zu Prüfen.

Falls es keinen Datenschutzbeauftragten bei dem Hersteller gibt, kann eine alternative Rolle die sicherheitstechnische
Eignung verifizieren z.B. der Sicherheitsbeauftragte. Diese Rolle darf nicht in der Entwicklung des Produktes teilnehmen
und muss direkt an die Geschäftsführung des Herstellers berichten.

## 5.1.2 Unterstützung von Audits

Die gematik kann für die Überprüfung der Umsetzung der Anforderungen zur sicherheitstechnischen Eignung Audits beim ePA-
FdV durchführen. Für die Hersteller gelten Mitwirkungspflichten.

Hinweis: Unterstützen bedeutet beispielsweise das Bereitstellen einer Release oder Beta-Version des Produkts, das
Bereitstellen eines Testsystems inkl. Test Accounts, kleine Anpassungen des Produktes, die eine Beschleunigung des Tests
ermöglichen (z.B. Entfernung von Certificate Pinning, Code Obfuscation) und Unterstützung bei Rückfragen.

## 5.2 Verwendete Standards

Für die Nutzung der Schnittstellen werden u.a. die folgenden Standards verwendet.

Informationen zu DMSLv2 sind unter https://www.oasis-open.org/standards#dsmlv2https://www.oasis-open.
org/standards#dsmlv2 verfügbar.

## 5.3 Integrating the Healthcare Enterprise IHE

Die dokumentenbezogenen Schnittstellen des ePA-Aktensystems und die Verarbeitungslogik des ePA-Frontend des Versicherten
basieren auf Transaktionen des IHE ITI Technical Frameworks (IHE ITI TF). Die IHE ITI-Implementierungsstrategie ist in
[gemSpec_DM_ePA] beschrieben.

Das ePA-Frontend des Versicherten nutzt die folgenden Integrationsprofile des IHE ITI TF:

   - Cross-Enterprise Document Sharing (XDS.b) Profile
   - Remove Metadata and Documents (RMD) Profile
   - Cross-Enterprise User Assertion (XUA) Profile
   - Advanced Patient Privacy Consents (APPC) Profile

Die folgende Tabelle bietet einen Überblick über die durch das ePA-Frontend des Versicherten umzusetzenden IHE ITI-
Akteure und assoziierte Transaktionen. Siehe auch [gemSpec_DM_ePA#Abbildung Überblick über IHE ITI-Akteure und
assoziierte Transaktionen].

Tabelle #: TAB_FdV_103 – IHE Akteure und Transaktionen

|=========================================================================================================================|
|Aktion                        | Profile|IHE-Akteur              |Transaktion                        |Referenz            |
|==============================|========|========================|===================================|====================|
|Suchanfrage auf Metadaten     |XDS.b   |Document Consumer       |Registry Stored Query [ITI-18]     |[IHE-ITI-TF2a]#3.18 |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|Herunterladen von Dokumenten  |XDS.b   |Document Consumer       |Retrieve Document Set [ITI-43]     |[IHE-ITI-TF2b]#3.43 |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|Einstellen von Dokumenten     |XDS.b   |Document Source         |Provide & Register Document Set-b  |[IHE-ITI-TF2b]#3.41 |
|                              |        |                        |[ITI-41]                           |                    |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|Löschen von Dokumenten        |RMD     |Document Administrator  |Remove Metadata [ITI-62]           |[IHE-ITI-RMD]#3.62  |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|AuthenticationAssertion       |XUA     |X-Service User          |Provide X-User Assertion [ITI-40]  |[IHE-ITI-TF2b]#3.40 |
|übertragen                    |        |                        |                                   |                    |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|Policy Document erstellen     |APPC    |APPC Content Creator    |-                                  |[IHE-ITI-APPC]      |
|------------------------------|--------|------------------------|-----------------------------------|--------------------|
|Interpretieren von Policy     |APPC    |APPC Content Consumer   |-                                  |[IHE-ITI-APPC]      |
|Documents                     |        |                        |                                   |                    |
|=========================================================================================================================|

XDS-Option „Document Replacement“ - Ersetzen eines existierenden Dokuments

Ein eingestelltes Dokument kann auch ein existierendes Dokument ersetzen. Dies erfolgt durch Verwendung der „Document
Replacement“-Option (XDS.b Document Source). Dazu wird das gleiche Dokument (mit geändertem Inhalt und nebst ggf.
geänderten DocumentEntry-Metadaten) erneut hochgeladen. Das neue Dokument erhält den Status „Approved“. Das alte
Dokument geht in den Status „Deprecated“.  Beide Dokumente werden über eine „Replace“-Association miteinander verbunden,
sodass nach dem Einstellen erkennbar ist, dass das neue Dokument das alte ersetzt. Lädt man erneut eine neue Fassung
hoch, erhält man zwei Dokumente im Status "Deprecated" und das neueste im Status "Approved".<br>
Alle alten Dokumente (Status "Deprecated") können nach wie vor gefunden und heruntergeladen werden. Einige Suchen
erlauben das Filtern nach Status bzw. zeigen per Default auch nur Dokumente im Status „Approved“ an.

Eingestellt (im "Submission Set") wird zum einen das neue Dokument inkl. Metadaten und zum anderen eine Association vom
Typ urn:ihe:iti:2007:AssociationType:RPLC, die auf das neue Dokument und das zu ersetzende, bestehende Dokument verweist
und so die "Replace"-Beziehung herstellt.

XDS-Option "Folder Management" - Verwendung von Ordnern

Ordner können durch die Option "Folder Management" (XDS.b Document Source) verwendet werden. Bei der kategorienbasierten
Berechtigungsverwaltung werden vom Aktensystem definierte Ordner genutzt. Nur für dynamische Dokumentensammlungen (z. B.
Kinderuntersuchungsheft und Mutterpass) werden Ordner durch Primärsysteme erstellt und vom Frontend ggf. ausgewertet.
Durch die Assoziation eines Dokumentes zu einem dieser Ordner wird das Dokument dem Ordner der entsprechenden
Dokumentenkategorie bzw. Dokumentensammlung zugeordnet.

Die XDS-Option "Folder Management" ist nur für den geschilderten Verwendungszweck zugelassen; ein selbständiges Anlegen
oder Bearbeiten von Ordnern und ihrer Metadaten ist durch das FdV nicht möglich. Das Entfernen von Dokumenten aus einem
Ordner durch Löschen der entsprechenden Assoziation ist nicht vorgesehen, da dies die direkte Zuordnung gemäß einer
Zugriffsunterbindungsregel verletzten könnte.

Weitere Festlegungen

Weitere übergreifenden Einschränkungen von IHE ITI-Transaktionen sowie Festlegungen spezieller Umsetzungsvorgaben bzgl.
einzelner Transaktionen sind in [gemSpec_DM_ePA] und [gemSpec_Dokumentenverwaltung] beschrieben.

Wenn im Rahmen der IHE Interface-Beschreibung der Begriff "Patient" verwendet wird, ist im Rahmen der vorliegenden
Spezifikation darunter der Aktenkontoinhaber zu verstehen.

Im ePA-Frontend des Versicherten werden fachliche Dokumente (Versichertendokumente) und technische Dokumente (Policy
Documents) unterschieden.

## 5.3.1 Policy Documents

Die Fachanwendung ePA verwendet das APPC-Profil für die Durchsetzung von Zugriffsregeln (Autorisierung) auf Dokumente.
 Die Zugriffsregeln werden gemäß APPC in Policy Documents beschrieben und als technische Dokumente im Aktenkonto des
Versicherten hinterlegt.

Für jeden Vertreter, jede berechtigte Leistungserbringerinstitution (LEI), den berechtigten Kostenträger (KTR) und jede
berechtigte Digitale Gesundheitsanwendung (DiGA) wird je ein Policy Document im Aktenkonto verwaltet.

Bei der Neuvergabe einer Berechtigung für Vertreter, LEI, DiGA oder KTR erstellt das ePA-Frontend des Versicherten ein
neues Policy Document und lädt es in das Aktenkonto hoch. Bei der Änderung einer Berechtigung (bspw. Verlängerung der
Berechtigungsdauer) lädt das ePA-Frontend des Versicherten das Policy Document aus der ePA-Dokumentenverwaltung herunter
(IHE-Akteur Content Consumer), bearbeitet es und lädt die veränderte Fassung als neu zu registrierendes Policy Document
in die ePA-Dokumentenverwaltung hoch (IHE APPC-Akteur Content Creator). Beim Hochladen einer veränderten Version eines
Policy Document wird die vorherige Version infolge des Hochladens des neuen Policy Document automatisch durch die ePA-
Dokumentenverwaltung gelöscht. Beim Entzug einer Berechtigung löscht das ePA-Frontend des Versicherten das entsprechende
Policy Document aus der ePA-Dokumentenverwaltung. 

Die ePA-Dokumentenverwaltung wertet die in den Policy Documents hinterlegten Zugriffsregeln aus. Es entscheidet unter
Berücksichtigung der Dokumentenmetadaten, ob der anfragende Nutzer den Dokumentenzugriff (bspw. Einstellen von
Dokumenten) durchführen darf oder ob der Dokumentenzugriff ablehnt wird. Das ePA-Frontend des Versicherten verarbeitet
Policy Documents nur intern.

Für die XDS-Metadaten eines Policy Documents gelten die Nutzungsvorgaben aus [gemSpec_DM_ePA#A_14961-*].

## 5.4 Benutzeroberfläche

Die Benutzeroberfläche, welche durch den Versicherten genutzt wird, um ePA-Anwendungsfälle auszuführen, ist Teil des
FdV.

Die folgenden Ausführungen zu Anforderungen an die visuelle Darstellung und Benutzerführung sind informativ und nicht
normativ.

## 5.4.1 Visuelle Darstellung

Für die visuelle Darstellung der Inhalte ist eine grafische Benutzeroberfläche erforderlich, welche die Daten des
Versicherten strukturiert und übersichtlich darstellt.

Das FdV soll eine einheitlich gestaltete Oberfläche zur Benutzerführung besitzen, um die Übersichtlichkeit in allen
Anwendungsfällen für den Nutzer zu gewährleisten. Es soll Menüfunktionen, Texte und andere Anzeigen eindeutig,
verständlich und widerspruchsfrei benennen bzw. darstellen.

Das FdV soll es dem Nutzer ermöglichen, zu jeder Zeit zu erkennen, in welchem ePA-Anwendungsfall sich die Applikation
gerade befindet.

Hinweis:<br>
Ist durch das Betriebssystem keine sichere und ausreichende Unterstützung des Hintergrundmodus möglich, kann die
Ausführung im Vordergrund erfolgen.

Sofern der Benutzer diese Permissions nicht schon bei der Installation freigegeben hat, ist die Freigabe beim Beginn
längerer Aktionen einzuholen und zu aktivieren. Insbesondere ist dies bei der Umschlüsselung zu beachten, da sie länger
dauern kann.

## 5.4.2 Benutzerführung

Die Bedienung des FdV soll für den Nutzer intuitiv gestaltet werden. Das FdV soll dem Nutzer alle anzeigbaren Texte
mindestens in der Sprache Deutsch bereitstellen. 

DIN Normen und Verordnungen zur Beachtung:

Eine hohe Akzeptanz der Benutzerfreundlichkeit oder Usability wird durch eine einfache, selbsterklärende Bedienung der
Oberfläche erreicht, die sich an gängigen Mustern des App-Designs orientiert.

Hierfür ist es auch erforderlich, die Erwartungshaltung der Zielgruppe zu kennen und zu berücksichtigen (z.B. auch
Menschen mit körperlichen oder geistigen Einschränkungen).

Die Akzeptanz des Frontends für den Versicherten hängt in großem Maße von folgenden Faktoren ab:

   - Anwendbarkeit auf verschiedenen Bildschirmgrößen und Auflösungen
   - Intuitive und unkomplizierte Handhabung
   - Anwendbarkeit auch im Offline-Modus
   - Zielgruppenorientierung
   - Leichte und verständliche Bereitstellung von Informationen
   - Einhaltung ergonomischer Aspekte (z.B. kurze Touchwege)
   - Konsistente Gestaltung der Links, Buttons, etc.

## 5.4.2.1 Technische Normen und Verordnungen zur Beachtung

|-----------------------------------------------------------------------------------------------------------------------|
|Die Entwicklung einer barrierearmen Anwendung unterliegt einem sich fortlaufend weiterentwickelnden Prozess. Die       |
|Umsetzung aller Anforderungen kann nicht mit der Ersteinführung der Anwendung sichergestellt werden.                   |
|-----------------------------------------------------------------------------------------------------------------------|

Zusätzlich zu den in diesem Kapitel aufgeführten Anforderungen zur Benutzerführung sollen auch die in der ISO 9241
aufgeführten Qualitätsrichtlinien zur Sicherstellung der Ergonomie interaktiver Systeme und Anforderungen aus der
Verordnung zur Schaffung barrierefreier Informationstechnik nach dem Behindertengleichstellungsgesetz (Barrierefreie-
Informationstechnik-Verordnung – BITV 2.0) beachtet werden.

DIN EN ISO 9241 – Teile mit Bezug zur Software-Ergonomie

Insbesondere sollen die nachfolgend aufgeführten Teile der ISO 9241 berücksichtigt werden:

   - Teil 8:       Anforderungen an Farbdarstellungen
   - Teil 9:       Anforderungen an Eingabegeräte – außer Tastaturen
   - Teil 110:   Grundsätze der Dialoggestaltung (ersetzt den bisherigen Teil 10)
   - Teil 11:     Anforderungen an die Gebrauchstauglichkeit – Leitsätze
   - Teil 12:     Informationsdarstellung
   - Teil 13:     Benutzerführung
   - Teil 14:     Dialogführung mittels Menüs
   - Teil 15:     Dialogführung mittels Kommandosprachen
   - Teil 16:     Dialogführung mittels direkter Manipulation
   - Teil 17:     Dialogführung mittels Bildschirmformularen
   - Teil 171:   Leitlinien für die Zugänglichkeit von Software BITV 2.0

Für die Entwicklung eines barrierefreien Frontend des Versicherten ist insbesondere die Verordnung zur barrierefreien
Gestaltung von Informationstechnik zu beachten.

BITV 2.0 - Barrierefreie Informationstechnik-Verordnung

Hinweis: Die Versionsnummern der aufgeführten Normen und Richtlinien spiegeln den Stand zum Zeitpunkt der Erstellung
dieses Dokumentes wider.

Die seit 2018 bestehende umfassende Forderung nach Umsetzung von Barrierefreiheit in der Informationstechnik erwächst
aus der EU Richtlinie 2016/2102 zur „Barrierefreiheit von Webseiten und mobiler Anwendungen öffentlicher Stellen“. Diese
Richtlinie musste im Jahr 2018 in Bundes- und Landesrecht übertragen werden. – Diese Gesetze verweisen jeweils auf die
Barrierefreie Informationstechnik-Verordnung mit Ausgabe vom 21. Mai 2019 (BITV 2.0).

Zur Erfüllung der BITV 2.0 § 3 Abs. 2 ist die durch die Veröffentlichung im europäischen Amtsblatt harmonisierte EN
301549 „Barrierefreiheitsanforderungen für IKT-Produkte und -Dienstleistungen“ (V 2.1.2 von 2018-08) anzuwenden. Diese
liegt in der Fassung von 2020-02 als DIN EN 301549 als deutsche Übersetzung vor. Die DIN EN 301549 ist eine
Beschaffungsnorm. Die darin aufgeführten und für den Anwendungsfall des FdV des E-Rezepts anzuwendenden Erfolgskriterien
sind in Kapitel 9 (Web mit 50 Erfolgskriterien), Kapitel 10 (Dokumente mit 46 Erfolgskriterien) und Kapitel 11 (Nicht
webbasierte Software mit 44 Erfolgskriterien) aufgeführt. Sie entsprechen den Erfolgskriterien von Level AA der 2.1.
WCAG 2.1 (Web Content Accessibility Guidelines).

Der sachliche Geltungsbereich der BITV 2.0 umfasst folgende relevanten Anwendungsbereiche für diese Spezifikation:

   - Webseiten,
   - nicht webbasierte Software mit mobilen Anwendungen.

Folgende Gestaltungsmerkmale der Anwendungen stellen die Barrierefreiheit sicher: 

   - wahrnehmbar,
   - bedienbar,
   - verständlich und
   - robust.    

In den genannten Normen und Standards werden nebeneinander die Belange von in der Handmotorik eingeschränkter, blinder,
sehbehinderter, gehörloser, schwerhöriger, geistig und lernbehinderter Menschen berücksichtigt.

Nach BITV 2.0 müssen Dokumente, die über dem FdV angezeigt werden, die gleichen Anforderungen an die Barrierefreiheit
erfüllen, wie sie an die Anwendung gestellt werden. Sämtliche bereitgestellten Dokumente müssen als barrierefreie
Formate angeboten werden, die mit dem Screenreader lesbar und navigierbar sind. Hierbei müssen die
behinderungsspezifischen Standardsoftwares zur Herstellung von Zugänglichkeit berücksichtigt werden.

Allgemeine Anforderungen an die Benutzerfreundlichkeit

Zusätzliche Sprachen können unterstützt werden.

Bezeichnungen sollen nach Möglichkeit vollständig ausgeschrieben sein, Abkürzungen sind zu vermeiden.

Um dem Nutzer die Bedienung zu vereinfachen, sollen ihm Hinweise angezeigt werden, die den Zweck sowie den inhaltlichen
Ablauf eines Anwendungsfalls betreffen.

Ist ein Anwendungsfall durchgeführt worden, muss das FdV das Ergebnis für den Versicherten klar verständlich anzeigen,
z. B. "Die Vertretung wurde erfolgreich eingerichtet.".

Ist ein Anwendungsfall durch den Nutzer abgebrochen worden oder technisch nicht durchführbar, muss der Nutzer ebenfalls
einen für ihn verständlichen Hinweis erhalten. In jedem Fall muss das Ergebnis für den Nutzer klar erkennbar sein.

Ist ein Anwendungsfall durch den Versicherten abgebrochen worden oder technisch nicht durchführbar, muss der Versicherte
ebenfalls einen für ihn verständlichen Hinweis erhalten. In jedem Fall muss das Ergebnis für den Versicherten klar
erkennbar sein.

Für die Anzeige in Fehlerfällen siehe Kapitel "".

Zur Sicherstellung, dass keine Daten versehentlich gelöscht werden, soll der Nutzer nach der Auswahl der Löschen-
Funktion für Dokumente darauf hingewiesen werden, dass es sich hierbei um eine unwiderrufliche Aktion handelt.

## 5.4.3 Anzeige von Dokumenten

Der Nutzer kann nach Dokumenten in der ePA suchen und diese herunterladen oder sich anzeigen lassen.

Technische Metadaten zu einem Dokument müssen nicht angezeigt werden.

Für die Anzeige der Dokumente werden die auf dem Gerät des Versicherten (GdV) verfügbaren Standardprogramme verwendet.
Unter einem Standardprogramm wird das im GdV mit einem Dokumenttypen verknüpfte Programm verstanden (z.B. Dateityp PDF
mittels eines auf dem GdV verfügbaren PDF Reader). Das FdV braucht keine Funktionalität zur Anzeige von Dokumenten in
beliebigem Format bereitstellen.

Ist kein Programm zur Anzeige des Dokumentenformates auf dem GdV verfügbar, dann kann der Nutzer das Dokument nur lokal
speichern.

Für Informationen zu strukturierten Dokumenten siehe [A_14761-*].

Wenn ein Arztbrief Dokument mit xml- und pdf-Anteil vorliegt, muss nur das PDF angezeigt werden.

Der Nutzer kann Dokumente in die ePA einstellen. Dafür müssen diese im FdV ausgewählt werden.

## 5.4.4 Sammlungen

Als Sammlung gemäß [] wird eine Zusammenstellung von Dokumenten verstanden, die in ihrer Gesamtheit betrachtet,
berechtigt oder anderweitig besonders behandelt werden müssen. Zum Beispiel werden einzelne Einträge im Impfpass als
separate Dokumente in ePA abgelegt. Als Sammlung "Impfpass" unterliegen sie jedoch bestimmten Verarbeitungsregeln.
Beispiele für andere Sammlungen sind der Mutterpass oder das Kinderuntersuchungsheft. Je nach Verarbeitungsvorgaben für
einzelne Sammlungen werden drei Sammlungstypen ("mixed", "uniform" und "atomic") eingeführt. Bestehende strukturierte
Dokumente werden einem dieser Typen zugeordnet, weitere strukturierte Dokumente und ihre Sammlungstypen können
konfiguriert werden. Weitere Details finden sich in []. 

Für das Erteilen einer Berechtigung für eine LEI auf einen Pass gilt das analog, d.h., das ePA-Frontend des Versicherten
muss die Erteilung einer Berechtigung zum Zugriff auf einen Pass in seiner Gesamtheit durch eine LEI unterstützen. Dies
wird in Anforderung A_19686-* geregelt.

Das lokale Speichern kann im PDF-Format angeboten werden.

Das Löschen einer Sammlungsinstanz umfasst das Löschen aller zur Instanz gehörenden Dokumente.

## 5.4.5 Metadaten für einzustellende Dokumente

Für Dokumente, welche durch den Nutzer in die ePA eingestellt werden, sind Metadaten anzugeben, auf deren Basis
Dokumente nachfolgend gesucht und heruntergeladen werden können.

Die XDS-Metadaten und ihre Nutzungsvorgaben sind in [gemSpec_DM_ePA] beschrieben.<br>
Es kann auf die Anzeige einzelner nutzbarer Metadatenattribute verzichtet werden, um eine übersichtliche Darstellung
beim Einstellen der Dokumente zu erreichen.

Das FdV soll für die Eingabe von Metadaten required-Attribute als Pflichtfelder kennzeichnen. Dabei soll unterschieden
werden zwischen einer einer einfachen Ansicht für das Einstellen von Dokumenten des Versicherten und einer erweiterten
Ansicht für das Einstellen von LE-Dokumenten durch den Versicherten. Vorgaben dazu werden in [gemSpec_DM_ePA] getroffen.

Defaultmäßig wird der Nutzer als Submission Set author (Einstellender) gesetzt. Die Werte für den author werden
mindestens mit den Informationen givenname, surname und title aus den subject des C.CH.AUT bzw. C.CH.AUT_ALT
Zertifikates vorbelegt. Das Zertifikat wird im Anwendungsfall "Login Aktensession" in die Session-Daten übernommen.

Entsprechend den Nutzungsvorgaben für die Verwendung von XDS-Metadaten sind für einzelne Attribute Value Sets zu
verwenden. Für eine bessere Bedienbarkeit bei der Eingabe der Metadaten werden die in der GUI auswählbaren Werte
defaultmäßig auf einen Teil des Value Sets gemäß  eingeschränkt. Über die Konfiguration des FdV hat der Nutzer die
Möglichkeit, die anzuzeigenden Werte zu ändern, d.h. nicht angezeigte Werte aus dem Value Set hinzuzunehmen oder
angezeigte Werte zu verbergen.

Das FdV soll dem Nutzer in der GUI für Attribute von Metadaten, welche entsprechend einem Value Set belegt werden, eine
konfigurierbare Auswahl anbieten. Wenn das Attribut optional ist, dann muss die Auswahl einen leeren Eintrag beinhalten.

Dokumente, die vom Versicherten am FdV eingestellt werden, werden vom Aktensystem entsprechend der verwendeten Metadaten
in die Kategorien bzw. die Folder "patientdoc", "childsrecord"  oder "eGA" eingeordnet, da sie mit submissionset.
authorRole = 102 eingestellt werden. Zusätzliche Metadaten können Dokumente als medizinisch relevante Dokumente
auszeichnen, etwa als Arztbrief, ohne dass sie deswegen in Ordner einsortiert werden, die für Dokumentenkategorien der
Leistungserbringer stehen. 

Das Frontend kann den Nutzer auch durch eine sinnvolle Vorauswahl bei der Klassifizierung und Typisierung unterstützen,
insbesondere falls Versicherte Dokumente in ihre Akte einstellen wollen, die ursprünglich von anderen
Leistungserbringern erstellt wurden, etwa Arztbriefe, die der Versicherte in Kopie erhalten hat.

Ggf. kann dazu bei unbekannten Codes der Anzeigename eines Codes (sofern mit übertragen bzw. verfügbar) angezeigt
werden.

## 5.4.6 Konfiguration des ePA-Frontend des Versicherten

Im Folgenden sind Konfigurationsparameter beschrieben, deren Werte für die Nutzung der Schnittstellen benötigt werden.
Darüber hinaus kann der Hersteller des ePA-Frontend des Versicherten zusätzliche Konfigurationsparameter definieren.

Entsprechend dem für die Akten-ID spezifizierten Format, besitzt die Akten-ID einen variablen und einen konstanten
Anteil. Der variable Anteil entspricht der Versicherten-ID, welche bspw. auf der eGK des Versicherten aufgedruckt ist.
 Das Erfassen der Akten-ID kann auf die Versicherten-ID beschränkt werden und automatisch um die konstanten Anteile
ergänzt werden.

Das entspricht den folgenden Parametern aus TAB_FdV_104 für Aktenkontoinhaber und für jede Vertretung:

   - FQDN Anbieter ePA-Aktensystem, 
   - Anbieter-ID.

Ein FdV kann an ein oder mehrere ePA-Aktensysteme gekoppelt werden.

## 6 Funktionsmerkmale

## 6.1 Allgemein

## 6.1.1 Aktensession-Verwaltung

Eine Aktensession in einem ePA-Frontend des Versicherten  bezeichnet die Sitzung eines Nutzers, in der dieser fachliche
Anwendungsfälle im Aktenkonto eines Versicherten ausführt. Hierbei kann es sich um das Aktenkonto des Nutzers selber
(Nutzer ist Aktenkontoinhaber) oder um das Aktenkonto eines zu vertretenden Versicherten handeln, wenn dieser eine
entsprechende Vertretung für den Nutzer eingerichtet hat.

Ein Aktenkonto wird eindeutig durch eine Akten-ID (RecordIdentifier, siehe ) referenziert. Der RecordIdentifier für sein
eigenes Aktenkonto wird dem Versicherten als Ergebnis der Eröffnung des Aktenkontos mitgeteilt. Wenn der Nutzer die
Vertretung eines anderen Versicherten wahrnimmt, dann erhält der Nutzer den RecordIdentifier von dem zu Vertretenden.

Eine Aktensession im ePA-Frontend des Versicherten beginnt mit dem Login und endet mit dem Logout des Nutzers aus dem
Aktenkonto. Das Logout erfolgt auf Wunsch des Nutzers, mittels eines Time-outs oder nach einem Fehler beim Login.

Das Login kann explizit nach Auswahl eines Aktenkontos im FdV durch den Nutzer ausgeführt werden.

Falls eine Auswahl zwischen eGK und alternativer kryptographische Versichertenidentität durch den Nutzer getroffen
wurde, kann diese in der Konfiguration gespeichert werden.

Das FdV kann dem Nutzer vor der Abmeldung wegen Inaktivität einen Hinweis einblenden, der es dem Nutzer ermöglicht, die
Aktensession fortzuführen.

Für die Dauer der Aktensession benötigt das ePA-Frontend des Versicherten einen gültigen Authentisierungstoken. Dieser
wird in der Aktivität "Authentisieren des Nutzers" im Anwendungsfall "Login Aktensession" erstmalig ausgestellt. Der
Authentisierungstoken hat eine Gültigkeitsdauer von 5 min und kann über einen Zeitraum von 120 min erneuert werden. Nach
diesem Zeitraum muss sich der Nutzer neu authentisieren.

Der Zeitpunkt zum Erneuern soll so gewählt werden, dass bei einem Fehlschlagen der Operation je nach Fehlermeldung die
Aktivität noch einmal ausgeführt werden kann, bzw. eine erneute Authentisierung gestartet werden kann.<br>
Zu einer Aktensession im FdV gehören Session-Daten, welche für die Dauer der Aktensession vorzuhalten sind. Die Session-
Daten beinhalten u.a. die in TAB_FdV_105 gelisteten Informationen. Eine vollständige Auflistung ist in "" beschrieben.

Tabelle #: TAB_FdV_105 – Session-Daten

|-----------------------------------------------------------------------------------------------------------------------|
|Authentisierungstoken        |Authentifizierungsbestätigung                                                            |
|-----------------------------|-----------------------------------------------------------------------------------------|
|Autorisierungstoken          |Autorisierungsbestätigung                                                                |
|-----------------------------|-----------------------------------------------------------------------------------------|
|Aktenschlüssel               |Symmetrischer Schlüssel, der alle Dokumente eines Versicherten schützt, indem der        |
|                             |Aktenschlüssel die zu den Dokumenten gehörigen Dokumentenschlüssel verschlüsselt.        |
|-----------------------------|-----------------------------------------------------------------------------------------|
|Kontextschlüssel             |Symmetrischer Schlüssel mit dem Metadaten der Dokumente, Policy Documents für die        |
|                             |Zugriffssteuerung und das Zugriffsprotokoll für die persistente Speicherung im ePA-      |
|                             |Aktensystem verschlüsselt werden.                                                        |
|-----------------------------------------------------------------------------------------------------------------------|

Die Informationen zu diesen Session-Daten ergeben sich aus dem Anwendungsfall "Login Aktensession".

Nach dem Ende der Aktensession (Anwendungsfall "Logout") werden die Session-Daten verworfen.

## 6.1.2 Kommunikation mit dem ePA-Aktensystem

Das ePA-Frontend des Versicherten nutzt TLS-Verbindungen für die Kommunikation zum ePA-Aktensystem. Es verbindet sich
mit der Komponente Zugangsgateway des Versicherten. Das ePA-Frontend des Versicherten führt eine Authentisierung des
Servers durch, wobei sich das Zugangsgateway mittels eines öffentlich prüfbaren Zertifikats authentisiert. Für die TLS-
Verbindung gelten die Vorgaben aus [gemSpec_Krypt].

Der Anbieter des ePA-Aktensystems, welchen der Versicherte gewählt hat, teilt dem Versicherten einen FQDN für den
Zugriff auf das ePA-Aktensystem mit. Im Falle einer Vertretung, muss der zu Vertretende dem Vertretenden den FQDN für
den Zugriff auf das ePA-Aktensystem mitteilen.

Falls für den FQDN mehrere IP-Adressen hinterlegt sind, wählt das ePA-Frontend des Versicherten zufällig eine der IP-
Adressen als Endpunkt für den Verbindungsaufbau aus. Die Komponente Zugangsgateway des Versicherten weist bei
Vollauslastung der Systemressourcen im ePA-Aktensystem die Verbindunganfrage ab. In diesem Fall kann das ePA-Frontend
des Versicherten zufällig eine der weiteren IP-Adressen für einen neuen Verbindungsaufbau auswählen.<br>
Jeder Anbieter eines ePA-Aktensystem verwaltet gemäß [gemSpec_Aktensystem#A_22688-*] die Schnittstellen-Konfiguration
des ePA-Aktensystems. Die einzelnen Module werden mit Key-/Value-Paaren mit den Kürzeln in TAB_FdV_106 identifiziert.

Tabelle #: TAB_FdV_106 – ePA-Aktensystem Komponenten, Schnittstellen-Konfiguration

|=======================================================================================================================|
|ePA-Aktensystem /TI-Komponente           |Attribut       |<path> für Schnittstelle                                     |
|=========================================|===============|=============================================================|
|Authentisierung                          |authn          |I_Authentication_Insurant                                    |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Autorisierung                            |authz          |I_Authorization_Insurant<br>                                 |
|                                         |               |I_Authorization_Management_Insurant                          |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Dokumentenverwaltung                     |docv           |I_Account_Management_Insurant<br>                            |
|                                         |               |I_Document_Management_Connect<br>                            |
|                                         |               |I_Document_Management_Insurant<br>I_Key_Management_Insurant  |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Status Proxy<br>(OCSP Responder)         |ocspf          |I_OCSP_Status_Information                                    |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Verzeichnisdienst Proxy                  |avzd           |I_Proxy_Directory_Query                                      |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Schlüsselgenerierungsdienst Typ 1        |sgd1           |                                                             |
|-----------------------------------------|---------------|-------------------------------------------------------------|
|Schlüsselgenerierungsdienst Typ 2        |sgd2           |                                                             |
|=======================================================================================================================|

Die URL wird entsprechend den Vorgaben in  gebildet.

Das Zugangsgateway für Versicherte authentisiert sich mit einem extended-validation-X.509-Zertifikat. Für Kriterien zur
Prüfung des Zertifikates siehe "".

Es gelten die Bedingungen für das TLS-Handshake gemäß [gemSpec_PKI#GS-A_4662].

Für jede Aktensession kann eine separate TLS-Verbindung genutzt werden.

Für die Schlüsselgenerierung müssen der Schlüsselgenerierungsdienst (SGD) 1 und SGD 2 parallel angesprochen werden
(siehe [A_17994-01]A_17994-01 ). Dafür baut das ePA-Frontend des Versicherten eine zweite TLS-Verbindung auf (siehe ),
welche nach Abschluss der Schlüsselgenerierung wieder geschlossen wird.

## 6.1.3 Sicherer Kanal zur Dokumentenverwaltung

Die Kommunikation zur Dokumentenverwaltung wird zusätzlich zu TLS über einen sicheren Kanal zwischen FdV und der
Vertrauenswürdigen Ausführungsumgebung (VAU) in der Dokumentenverwaltung gesichert. Die Dokumentenverwaltung bietet dem
FdV die folgenden Operationen ausschließlich über einen sicheren Kanal an:

   - I_Document_Management_Insurant::ProvideAndRegisterDocumentSet-b
   - I_Document_Management_Insurant::RegistryStoredQuery
   - I_Document_Management_Insurant::RemoveMetadata
   - I_Document_Management_Insurant::RetrieveDocumentSet
   - I_Document_Management_Insurant::RestrictedUpdateDocumentSet
   - I_Account_Management_Insurant::GetAuditEvents
   - I_Account_Management_Insurant::SuspendAccount
   - I_Account_Management_Insurant::ResumeAccount
   - I_Key_Management_Insurant::StartKeyChange
   - I_Key_Management_Insurant::GetAllDocumentKeys
   - I_Key_Management_Insurant::PutAllDocumentKeys
   - I_Key_Management_Insurant::FinishKeyChange
   - I_Document_Management_Connect::OpenContext
   - I_Document_Management_Connect::CloseContext

Für Informationen zum Kommunikationsprotokoll zwischen dem ePA-Frontend des Versicherten  und einer VAU siehe  und .

## 6.1.4 Geräteautorisierung

Um einen möglichen Missbrauch und Identitätsdiebstahl erkennen zu können, wird eine Berechtigungsprüfung auf Geräteebene
auf Seiten der Versicherten umgesetzt. Der Zugriff auf ein Aktenkonto ist zulässig, wenn das Gerät, auf dem das FdV
genutzt wird, durch den Nutzer über einen separaten Benachrichtigungskanal (E-Mail mit Freischalt-Link) zur Benutzung
eines Aktenkontos autorisiert wurde. Siehe auch .

Das Gerät wird durch die Gerätekennung (DeviceID) identifiziert. Die Gerätekennung beinhaltet die Geräteidentität und
den Gerätenamen. Die Geräteidentität ist eine Zufallszahl, welche dem ePA-Frontend des Versicherten von der
Autorisierung übermittelt wird. Der Gerätename ist ein bis zur 64 Zeichen langer String, welcher durch den Nutzer in der
Konfiguration des ePA-Frontend des Versicherten hinterlegt wird (siehe A_15292-*).

Beim erstmaligen Login eines Nutzers von einem GdV wird die Gerätekennung mit leerem Geräteidentifikator (phr:DeviceID::
Device) im Aufruf gesandt. Da noch kein bekannter Geräteidentifikator für dieses GdV in der Autorisierung registriert
ist, antwortet die Autorisierung mit dem Fehler DEVICE_UNKNOWN und einer Zufallszahl im Fehlertext. Das ePA-Frontend des
Versicherten speichert die Zufallszahl als Geräteidentifikator lokal und verwendet sie in allen Aufrufen gegenüber der
Komponente Autorisierung.

Für die Struktur von DeviceID siehe [PHR_Common.xsd].

## 6.1.5 Zertifikatsprüfung

Das ePA-Frontend des Versicherten  verwendet bei den in TAB_FdV_110 dargestellten Aktivitäten Zertifikate.

Tabelle #: TAB_FdV_110 – Zertifikatsnutzung

|========================================================================================================================|
|Aktivität                        |Zertifikat der|Zertifikatstyp               |Rollen-OID                   |Nutzung    |
|                                 |TI            |                             |                             |           |
|=================================|==============|=============================|=============================|===========|
|Einlesen der eGK                 |ja            |C.CH.AUT                     |oid_egk_aut                  |passiv     |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|TLS-Verbindungsaufbau zum        |nein          |TLS Internet Zertifikat      |n/a                          |aktiv      |
|Zugangsgateway des Versicherten  |              |                             |                             |           |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|Authentisierung                  |ja            |C.CH.AUT<br>C.CH.AUT_ALT     |oid_egk_aut<br>              |passiv     |
|                                 |              |                             |oid_egk_aut_alt              |           |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|Aufbau sicherer Kanal zur VAU    |ja            |C.FD.AUT                     |oid_epa_vau                  |aktiv      |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|Berechtigung von LEI, DiGA oder  |ja            |C.HCI.ENC                    |oid_smc_b_enc                |aktiv      |
|KTR erteilen<br>Berechtigung von |              |                             |                             |           |
|LEI ändern                       |              |                             |                             |           |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|Verbindungsaufbau SGD            |ja            |C.SGD-HSM.AUT                |oid_sgd1_hsm<br>oid_sgd2_hsm |aktiv      |
|---------------------------------|--------------|-----------------------------|-----------------------------|-----------|
|Verschlüsselung pseudonymisierter|ja            |C.FD.ENC                     |oid_epa_fdz                  |aktiv      |
|Dokumente für Forschungszwecke   |              |                             |                             |           |
|========================================================================================================================|

Es gelten folgende übergreifende Festlegungen für die Prüfung aktiv durch das ePA-Frontend des Versicherten genutzter
Zertifikate.

"Ein Zertifikat aktiv verwenden" bedeutet im Sinne von A_15872, dass ein ePA-FdV einen dort aufgeführten öffentlichen
Schlüssel innerhalb einer kryptografischen Operation (Signaturprüfung, Verschlüsselung, Signaturprüfung von öffentlichen
(EC)DH-Schlüsseln etc.) nutzt. Erhält ein ePA-Frontend des Versicherten bspw. einen Access-Token, in dem Signaturen und
Zertifikate enthalten sind und behandelt es diesen Token als opakes Datenobjekt, ohne die Zertifikate darin gesondert zu
betrachten, dann verwendet das ePA-Frontend des Versicherten diese Zertifikate im Sinne von A_15872 passiv.

## 6.1.5.1 Vertrauensanker des TI-Vertrauensraum

Der Vertrauensraum der TI ist in [gemSpec_PKI#8.1] beschrieben. Für das ePA-Frontend des Versicherten gelten abweichende
Vorgaben, da das ePA-FdV nicht innerhalb der TI betrieben wird. Diese Abweichungen werden im Folgenden beschrieben.

Die Initialisierung des TI-Vertrauensraums und der Wechsel des TI-Vertrauensankers wird beim ePA-Frontend des
Versicherten

durch die Bereitstellung der FdV Applikation durchgeführt.

## 6.1.5.2 TSL-Behandlung

Folgende Vorgaben gelten für den Bezug und die Verarbeitung der TSL.

Für die Spezifikation der Schnittstelle siehe .

Der Aufbau und der Inhalt der TSL sind durch [ETSI_TS_102_231_V3.1.2] gegeben und in  beschrieben.

Die Bedingungen an den Vertrauensstatus der TSL sind in [gemSpec_TSL#8.2.2] beschrieben. Für das ePA-FdV gilt eine "TSL-
Graceperiod" von 0 Tagen, d.h., die TSL-Informationen sind nicht mehr vertrauenswürdig, wenn das aktuelle Datum nach dem
Datum nextUpdate der TSL liegt.

Hinweis: Eine Möglichkeit zur Umsetzung ist, im Rahmen der Aktualisierung der TSL (vgl. A_15874) nach positiver Prüfung
der TSL-Signatur die CA-Zertifikate aus der TSL in verschiedene zugriffsgeschützte Verzeichnisse zu legen: bspw. einmal
für HBA/SMC-B/eGK-CAs, einmal für SGD-Zertifikate und einmal für CAs der Komponenten-PKI der TI. Die Verzeichnisse
dienen dann als Truststore für die Zertifikatsprüfung, womit sich die Umsetzungskomplexität der Vorgabe aus A_15873
Punkt 2 reduziert.

Hinweis: Es ist in Bezug auf die CC-Evaluierung hilfreich, wenn die TSL-Signaturprüfung mit einer speziell dafür
geschriebenen (und gehärteten) Programmkomponente durchgeführt wird. Bei einer anschließenden XML-Auswertung der TSL mit
einer Standard-XML-Bibliothek können die verarbeiteten XML-Daten dann als vertrauenswürdig angesehen werden.

## 6.1.5.3 Zertifikatsprüfung von Zertifikaten der TI

In der folgenden Anforderung sind die Schritte zum Prüfen eines Zertifikates der TI beschrieben. In den Schritten werden
TUC_PKI_* referenziert. Sie dienen als Rahmen für den Ablauf der Prüfschritte. Die TUC_PKI_* sind in dieser Afo nicht
normativ umzusetzen.

Für die Prüfung des Online-Status von Zertifikaten der TI wird die Schnittstelle I_OCSP_Status_Information genutzt.
Siehe [gemSpec_PKI#9]. Die Schnittstelle wird durch den Status-Proxy der Komponente Zugangsgateway des Versicherten
angeboten. Siehe auch .

## 6.1.5.4 Zertifikatsprüfung von Internet-Zertifikaten

Folgende Vorgaben gelten für die Prüfung von Internet-Zertifikaten.

Hinweis 1: Der erste Teil von A_15887-* ist gleichbedeutend damit, dass das CA-Zertifikat im Zertifikats-Truststore
eines aktuellen Webbrowsers ist.

Hinweis 2: gemäß Absprache mit den ePA-Industriekonsortien soll bei der Prüfung nach A_15887-* die Menge der zulässigen
CA:

   1. initial auf die CA-Zertifikate von GlobalSign, DigiCert und Entrust aus der Liste von https://wiki.mozilla.
      org/CA/Included_Certificates -> "Included CA Certificates" beschränkt werden.
   2. weiterhin muss die Liste die CA-Zertifikate von ISRG (Let's encrypt) enthalten (fachlicher Hintergrund: das
      Gesundheitspotral https://gesund.bund.de/https://gesund.bund.de/ verwendet diesen TSP).
   3. und zukünftig auf eine Menge von CA-Zertifikaten beschränkt werden, die in Abhängigkeit zu
      [gemSpec_Aktensystem#A_22409] steht und bei Änderung von der gematik an die ePA-FdV-Hersteller gesendet wird.

## 6.1.6 Dokumente

Das ePA-Aktensystem unterstützt die einzelne Dokumente bis zu einer Größe von 25 MB.

Hinweis: Aktive Elemente sind alle code-ausführenden Anteile eines Dokuments, also etwa Makros oder Skripte. Diese
dürfen im Kontext des FdV nicht ausgeführt werden, etwa indem auch bei zugelieferten Bibliotheken diese Funktionalität
deaktiviert wird.<br>
Die Verwendung explizit externer Applikationen wird dabei nicht betrachtet, da hier aus Sicht des ePA-FdV der Vorgang
mit dem Herunterladen des Dokuments als abgeschlossen angesehen wird.

## 6.1.7 Umschlüsselung der Dokumente

Die Dokumente der elektronischen Patientenakte sind mit ePA-spezifischen kryptographischen Schlüsseln gesichert. Ab der
ePA Version 2.0 ist es möglich, dass der Versicherte zu jedem Zeitpunkt eine Umschlüsselung starten kann. Dadurch kann
bei Verdacht oder bei tatsächlicher Kompromittierung eine missbräuchliche Nutzung der Dokumente verhindert werden.

Die Umschlüsselung kann über das FdV vom Versicherten gestartet werden.

## 6.1.7.1 Kryptographische Architektur der Dokumentenverschlüsselung

Die Dokumente der elektronischen Patientenakte werden verschlüsselt im Aktensystem abgelegt. Der Betreiber hat keinen
Zugriff auf die Klartext-Daten der Dokumente. Die Versicherten können jederzeit alle Dokumente entschlüsseln und die
Leistungserbringer dürfen im Rahmen ihrer von den Versicherten festgelegten Berechtigungen für sie freigegebene
Dokumente über ihr Primärsystem entschlüsseln. Um diese Funktionalität umzusetzen sind verschiedene Verschlüsselungen
mit unterschiedlichen Schlüsseln notwendig. Diese müssen bei der Umschlüsselung ausgetauscht werden. In der folgenden
Abbildung sind die verschiedenen Schlüssel aufgeführt.

![img](4650108605665239594.]

Abbildung #: Kryptographische Schlüssel der ePA

Für die Verschlüsselung eines Dokumentes wird ein dokumentenindividueller symmetrischer Dokumentenschlüssel verwendet.
Dieser wird mit einem versichertenindividuellen Aktenschlüssel verschlüsselt. Der Aktenschlüssel wird mit
nutzerindividuellen Schlüsseln des SGD1 und SGD2 verschlüsselt und anschließend in der Komponente Autorisierung
abgelegt. Nutzer sind berechtigte LEI, Kassen und Vertreter des Versicherten.

Die mit dem Dokumentenschlüssel gesicherten Dokumente und die mit dem Aktenschlüssel verschlüsselten Dokumentenschlüssel
werden mit einem aus einem betreiberspezifischen Schlüssel abgeleiteten aktenspezifischen Schlüssel nochmals
verschlüsselt und anschließend im Aktensystem abgelegt.

Die Metadaten werden mit dem versichertenindividuellen Kontextschlüssel verschlüsselt. Die verschlüsselten Metadaten
werden nochmals mit dem aus dem betreiberspezifischen Schlüssel abgeleiteten aktenspezifischen Schlüssel verschlüsselt
und im Aktensystem abgelegt. Die Kontextschlüssel werden mit den nutzerindividuellen Schlüsseln des
Schlüsselgenerierungsdienstes 1 und 2 (SGD1 und SGD2) symmetrisch verschlüsselt und anschließend in der Komponente
Autorisierung abgelegt.

Ab Release 4.0.1 ist die explizite, vom Versicherten angestoßene, Erneuerung der Akten-, Kontext- und SGD1- und SGD2
Schlüssel umgesetzt. Der Betreiber kann unabhängig davon regelmäßig den betreiberspezifischen Schlüssel erneuern.

Einzelne Rückgabewerte bei der Kommunikation zwischen dem FdV und der Autorisierungskomponente und der
Dokumentenverwaltung sind vom jeweiligen Absender signiert, damit beim Weiterleiten von Argumenten (z.B. bei der
Übermittlung der von der Autorisierung ausgestellten rollbackTime) der Empfänger diese über eine Signaturprüfung
validieren kann. Es werden sowohl die Herkunft als auch der Signaturerstellungszeitpunkt vom Empfänger geprüft. Das
Frontend des Versicherten prüft die Signaturen der Rückgabewerte nicht.

## 6.1.8 ePA-FdV für Desktop-Plattformen

Wird das FdV nicht auf einem mobilen Gerät betrieben, muss die Verwendung des FdV durch mehrere Versicherte für den
Zugriff auf die individuellen ePA möglich sein.

## 6.1.9 Freigabe von Dokumenten für Forschungszwecke

Einem Versicherten oder einem Vertreter muss die Freigabe von Dokumenten der Akte des Versicherten in pseudonymisierter
Form für Zwecke der Forschung gemäß §363 Abs. 1-7 SGB V nach erteilter Einwilligung gemäß § 363 Absatz 2 SGB V
ermöglicht werden. Darüber hinaus muss es einem Versicherten oder einem Vertreter möglich sein, die Verwendung zuvor
freigegebener Daten für Forschungszwecke zu widerrufen.

Die Freigabe von Dokumenten aus der Akte eines Versicherten ist auf die Freigabe von Daten in strukturierten Dokumenten
(MIOs) beschränkt. Die freizugebenden Dokumente werden durch das ePA-FdV unter Verwendung von Pseudonymisierungsvorgaben
("Pseudonymisierungsschema") in pseudonymisierte Dokumente übertragen. Ausschließlich pseudonymisierte Dokumente dürfen
für Forschungszwecke an das Forschungsdatenzentrum übermittelt werden. Der Versicherte oder ein Vertreter muss dabei für
jeden Freigabevorgang auswählen können, welche Dokumente freigegeben werden sollen. Ein Freigabevorgang kann dabei auch
die Freigabe zu einer automatisch zu wiederholenden Übermittelung eines Dokuments an das Forschungsdatenzentrum
beinhalten, beispielsweise nach Aktualisierungen eines Dokuments.

Neben der Pseudonymisierung der Daten des Versicherten (pD) wird eine Arbeitsnummer (AN) und ein Lieferpseudonym (LP)
auf Basis der KVNR des Versicherten verwendet. Zum Nachweis der Authentizität des Absenders fordert das ePA-FdV
die Erstellung von nicht personengebundenen Transporttoken von der Autorisierung des Aktensystems an, jeweils ein
Token für die Vertrauensstelle mit der Arbeitsnummer und dem Lieferpseudonym und ein Token für das
Forschungsdatenzentrum mit der Arbeitsnummer. Die Einbettung der Arbeitsnummer und des Lieferpseudonyms in diese
signierten Token stellt darüber hinaus sicher, dass alle Dokumentenfreigaben des ePA-FdV ausschließlich für dieses
Lieferpseudonym erfolgen können. 

Das Transporttoken für die Vertrauensstelle mit dem Lieferpseudonym und der Arbeitsnummer werden an die Vertrauensstelle
(VST, gemäß § 303c SGB V) übertragen.

Das Transporttoken für das Forschungsdatenzentrum mit der Arbeitsnummer und die Ende-zu-Ende verschlüsselten
pseudonymisierten Dokumente werden an das Forschungsdatenzentrum (FDZ, gemäß § 303d SGB V ) übertragen.

Eine Übersicht der freigegebenen Dokumente und etwaiger Widerrufe der Freigabe wird zentral in einem Dokument des
Versicherten in seiner Akte verwaltet (Aufzeichnungsliste).

Die Referenzierung der freigegebenen Dokumente gegenüber dem Forschungsdatenzentrum erfolgt nicht durch Metadaten der
Akte (z.B. document.UniqueId). Das ePA-FdV generiert daher pro Dokument (MIO) einen eigenen Identifier. Dieser wird in
der Aufzeichnungsliste abgelegt und sowohl für folgende Freigaben, als auch den Widerruf der Dokumente verwendet.

![img](196241282802640251.]

Abbildung # Übersicht des Ablaufs der Freigabe von Daten für Forschungszwecke

## 6.1.9.1 Einwilligung in die Datenfreigabe

Hinweis: das ePA-FdV vermerkt den Status einer erteilten, bzw. widerrufenen Einwilligung nach § 363 Absatz 2 SGB V in
der Akte des Versicherten im Dokument der aufgezeichneten Freigaben/Widerrufe (Aufzeichnungsliste).

Hinweis: Es müssen alle Dokumente widerrufen werden, die in der Aufzeichnung der freigegebenen und widerrufenen
Dokumente als freigegeben aber noch nicht widerrufen vermerkt sind.

## 6.1.9.2 Freigabe der Dokumente und Pseudonymisierung

Hinweis: Es muss also mindestens ein XDS-Dokument vor einer erneuten Freigabe hinzugekommen, gelöscht oder verändert
worden sein. 

Hinweis: Die Pseudonymisierungsvorgaben für die strukturierten Dokumente werden zusammen mit den
Implementierungsvorgaben ("Implementation-Guidelines") zu den strukturierten Dokumenten auf GitHub veröffentlicht und
enthalten Listen von FHIR-Path-Ausdrücken, welche eindeutig und vollständig die für ein pseudonymisiertes Dokument
zulässigen Elemente eines MIOs angeben.

## 6.1.9.3 Übermittlung der Daten an das Forschungsdatenzentrum

Die Übermittlung der freigegebenen und pseudonymisierten Dokumente an das Forschungsdatenzentrum erfolgt verschlüsselt
und unter Verwendung einer Arbeitsnummer. Die gleiche Arbeitsnummer und ein Lieferpseudonym werden an die
Vertrauensstelle übermittelt.

Ein Übermittlungsvorgang beinhaltet die Übermittlung der pseuonymisierten Dokumente gemäß Auswahl durch den Versicherten
oder einen Vertreter. Ein solcher Vorgang kann dabei mehr als einen Aufruf der Schnittstelle des Forschungsdatenzentrums
erfordern.

Ein zur Freigabe ausgewähltes Dokument kann in der Akte des Versicherten durch mehr als ein XDS-Dokument repräsentiert
sein (Sammlungstypen mixed und uniform). Für jeden Übermittlungsvorgang eines Dokuments dieses Sammlungstyps müssen alle
aktuellen (Status 'approved') XDS-Dokumente des assoziierten Ordners (XDS Folder) berücksichtigt werden.

Ein Übermittlungsvorgang zum Zweck des Widerrufs erfolgt analog zu einer Datenfreigabe. Anstelle der pseudonymisierten
Dokumente wird jedoch lediglich deren ID an das Forschungsdatenzentrum übertragen.

Erläuterung zum Begriff "Übermittlungsvorgang": Ein Übermittlungsvorgang beinhaltet einen Aufruf der Schnittstelle der
Vertrauensstelle und -- je nach Umfang der freigegebenen Dokumente -- einen oder mehrere Aufruf der Schnittstelle des
Forschungsdatenzentrums.

Hinweis: Für das ePA-FdV gilt der Vorgang der Übermittelung an das FDZ als erfolgreich abgeschlossen, wenn sowohl der
Aufruf der Schnittstelle der Vertrauensstelle [I_VST], als auch der anschließende Aufruf der Schnittstelle des
Forschungsdatenzentrums [I_FDZ] erfolgreich war

## 6.1.9.4 Umfang und Aufzeichnung der Freigabe

Jede Freigabe und jeder Widerruf eines strukturierten Dokuments muss erfasst werden und für den Versicherten oder einen
Vertreter einsehbar sein. Für diese Aufzeichnungen wird ein vorgegebenes Dokument (Aufzeichnungsliste) in der Akte des
Versicherten verwendet. Anhand dieser Aufzeichnungen ist nachvollziehbar, welche Dokumente zu welchem Zeitpunkt
freigegeben und an das Forschungsdatenzentrum übermittelt und welche widerrufen wurden und wer den jeweiligen Vorgang
initiiert hat. Die aufgezeichnete Dokumenteninformation zu einer Freigabe kann auch für einen eindeutigen Widerruf der
Freigabe verwendet werden.

Bei der Aufzeichnung der freigegebenen Dokumente, bzw. der zu übermittelnden Artefakte, muss sichergestellt sein, dass
keine Situation eintreten kann welche dazu führt, dass im Forschungsdatenzentrum Dokumente vorliegen, deren Freigabe für
einen Versicherten nicht mehr einsehbar und dahingehend auch nicht widerrufbar ist. In die Aufzeichnungsliste werden
freizugebende Daten daher vor einer Übermittlung eingetragen und ein Widerruf erst nach Erhalt der Bestätigung durch das
Forschungsdatenzentrum. Das ePA-FdV selbst muss daneben Maßnahmen vorsehen, die sicherstellen, dass der genannte
eindeutige Zustand auch nach einer unvorhergesehenen Unterbrechung der Kommunikation erreicht werden kann. 

Hinweis: A_21878-* bezieht sich auf die Einwilligung gemäß § 363 Absatz 2 SGB V (A_21843-*). Als Nachweis genügt der
Einwilligungsstatus, welcher gemäß den Vorgaben in [FD_Aufzeichnung] angegeben wird. 

Hinweis: Die document.UniqueId des Dokuments ändert sich bei jeder Modifikation. Durch die Verwendung der
'referenceIdList' mit jeweils der Referenz auf den initialen Wert der document.UniqueId und in Kombination mit
'FindDocumentsByReferenceID' ist das Dokument jederzeit erreichbar.

Hinweis: Bei einem Abbruch der Übermittlung, beispielsweise durch einen schwachen Akku des Geräts des ePA-FdV, ist nicht
bekannt, ob und welche Dokumente schon an das Forschungsdatenzentrum übertragen wurden. Ein ePA-FdV soll daher den
Vorgang regulär beenden können, beispielsweise durch erneute Übermittlung der betroffenen Dokumente.

## 6.1.9.5 Aktenumzug

Bei einem Wechsel des Kostenträgers (Aktenumzug) ist eine eigenständige Erteilung der Einwilligung gemäß § 363 Absatz 2
SGB V gegenüber dem neuen Kostenträger erforderlich.

Diese erneute Einwilligung muss vor einem Umzug der Akte erteilt werden, wenn aktuell noch freigegebene Dokumente im
Forschungsdatenzentrum vorliegen und diese Freigabe nach dem Umzug erhalten bleiben soll. Wird diese Einwilligung nicht
erteilt, müssen vor dem Umzug der Akte alle freigegebenen Dokumente widerrufen werden.

## 6.1.10 Anbindung an das Nationale Gesundheitsportal

Durch die Kopplung der ePA mit dem Nationalen Gesundheitsportal ([NGP]) soll dem Versicherten über das ePA-FdV,
unabhängig von Gesundheitskompetenzniveau, eine Hilfestellung angeboten werden, durch die sich der Versicherte einen
Zugang zu einfach verständlichen und von Experten bereitgestellten Gesundheitsinformationen verschaffen kann.

Der Versicherte hat über das ePA-FdV zwei Möglichkeiten auf die Inhalte des Nationalen Gesundheitsportal zu zugreifen.
Einerseits kann der Versicherte über eine selektive schlagwortbasierte Suche aus dem ePA-FdV heraus auf die Inhalte des
Nationalen Gesundheitsportal zugreifen. In dem Fall, dass im ePA-Aktensystem bereits strukturierte Daten vorliegen
(eingestellt durch den Versicherten und/oder berechtigte Leistungserbringer bzw. Dritte), kann der Versicherte über das
ePA-FdV gezielt auf im Nationalen Gesundheitsportal liegende Informationen zu Symptomen, Diagnosen oder medizinische
Fachbegriffe zugreifen.

## 6.2 Implementation ePA-Anwendungsfälle im FdV

In diesem Kapitel wird die Umsetzung der im systemspezifischen Konzept [gemSysL_ePA] spezifizierten Anwendungsfälle im
FdV beschrieben.

## 6.2.1 Übergreifende Festlegungen

Voraussetzung für die Nutzung des FdV ist das Vorhandensein eines Aktenkontos:

   - Der Versicherte verfügt über ein aktiviertes Aktenkonto (Anderenfalls ist ausschließlich der Anwendungsfall für die
     Aktivierung des Aktenkontos ausführbar.).
   - Die Akten-ID (der RecordIdentifier) des Aktenkontos, welche sich mittels der Versicherten-ID des Aktenkontoinhabers
     bestimmen lässt, ist im ePA-Frontend des Versicherten  bekannt.
   - Der FQDN für den Zugriff auf das ePA-Aktensystem ist im ePA-Frontend des Versicherten bekannt.

Die Rolle des Nutzers kann durch den Vergleich der Versicherten-ID aus dem Authentisierungszertifikat der eGK (C.CH.AUT)
 bzw. der alternativen kryptographische Versichertenidentität (C.CH.AUT_ALT) des Nutzers mit der Versicherten-ID aus der
Akten-ID bestimmt werden.

## 6.2.2 Fehlerbehandlung

Tritt ein Fehler bei der Verarbeitung von Operationsaufrufen des ePA-Aktensystems auf, dann antworten die Komponenten
des ePA-Aktensystems mit einer Fehlermeldung. Das Format und die verwendeten Fehlercodes sind in den Spezifikationen der
Interfaces beschrieben. Weiterhin können Fehler in der lokalen Verarbeitung auftreten.

Das FdV soll dem Nutzer nach einem Abbruch eine verständliche Fehlermeldung anzeigen.

Wenn die Möglichkeit besteht, dass der Nutzer das fehlerverursachende Problem selbst beheben kann, kann das FdV den
Nutzer auf die Lösung hinweisen. Bspw. kann dem Nutzer bei einer gesperrten PIN der Anwendungsfall "PIN der eGK
entsperren" angeboten werden.

## 6.2.3 Aktivitäten

Dieser Abschnitt beschreibt Aktivitäten, welche durch verschiedene Anwendungsfälle genutzt werden.

## 6.2.3.1 Authentisieren des Nutzers

Mit dieser Operation authentisiert sich der Nutzer am ePA-Aktensystem. Das ePA-FdV erhält bei erfolgreicher
Authentisierung einen Authentisierungstoken.

Die Dauer der Gültigkeit des Authentisierungstoken ist in [gemSpec_Authentisierung_Vers] beschrieben.

## 6.2.3.2 Authentisierungstoken erneuern

Mit dieser Operation kann das ePA-Frontend des Versicherten den Authentisierungstoken am ePA-Aktensystem verlängern.

Der vorher genutzte Authentisierungstoken wird gelöscht.

Im Fehlerfall kann die Operation wiederholt oder eine neue Authentisierung des Nutzers gestartet werden.

## 6.2.3.3 Dokumentenset in Dokumentenverwaltung hochladen

Mit dieser Operation werden ein oder mehrere Dokumente in die Dokumentenverwaltung hochgeladen. Hierbei kann es sich
entweder um durch den Nutzer ausgewählte (fachliche) Versichertendokumente oder um technische Dokumente (z.B. ein Policy
Document) handeln. Eine Mischung beider Arten von Dokumenten innerhalb eines Dokumentensets ist nicht erlaubt.

Für die XDS-Metadaten von Dokumenten des Versicherten gelten die Nutzungsvorgaben aus [gemSpec_DM_ePA#A_14760-*]. Für
die XDS-Metadaten eines Policy Documents gelten die Nutzungsvorgaben aus [gemSpec_DM_ePA#A_14961-*].

Technische Dokumente (Policy Documents) werden nach der Übertragung in das Aktenkonto durch die Dokumentenverwaltung
ausgewertet.

Das ePA-Aktensystem lehnt beim Einstellen von Dokumenten Requests ab, wenn die Summe der Größe der Dokumente in einem
Submission Set 250 MB überschreitet. Das ePA-Frontend des Versicherten kann Einstellversuche von Dokumentensets
unterbinden, wenn diese von der Dokumentenverwaltung aufgrund der Größenbeschränkung abgelehnt würden.

## 6.2.3.4 Dokumentenset aus Dokumentenverwaltung herunterladen

Mit dieser Operation werden ein oder mehrere Dokumente anhand der Document Unique IDs aus den XDS-Metadaten aus dem
Aktenkonto heruntergeladen.

## 6.2.3.5 Dokumentenset in Dokumentenverwaltung löschen

Mit dieser Operation werden ein oder mehrere Dokumente anhand ihrer entryUUIDs aus der Dokumentenverwaltung gelöscht.
Die XDS-Metadaten wurden vorab mit einer Suche nach Dokumenten im ePA-Aktensystem ermittelt.

## 6.2.3.6 Suche nach Dokumenten in Dokumentenverwaltung

Mit dieser Operation wird eine Suchanfrage über die XDS-Metadaten der Dokumente im Aktenkonto an die
Dokumentenverwaltung gesendet.

Der zusätzliche Parameter "$XDSDocumentEntryTitle" filtert die Suchergebnismenge über das Attribut XDSDocumentEntry.
title. Dabei ist die Angabe von Platzhaltern (wie für Suchanfragen über den Parameter $XDSDocumentEntryAuthorPerson)
möglich, die sich verhält wie das SQL Schlüsselwort "LIKE" in Kombination mit den anzugeben Wildcard-Zeichen "%", um
jedes beliebige Zeichen und "_", um ein einzelnes beliebiges Zeichen zu finden.

Der optionale Parameter "$XDSDocumentEntryAuthorInstitution" filtert die Suchergebnismenge über das Attribut
XDSDocumentEntry.authorInstitution.

## 6.2.3.7 Vergebene Berechtigungen bestimmen

Mit dieser Operation werden die für das Aktenkonto vergebenen Berechtigungen ermittelt. Für jeden Berechtigten ist in
der Komponente Autorisierung ein AuthorizationKey und in der Komponente Dokumentenverwaltung ein technisches Dokument
(Policy Document) hinterlegt. Letzteres beinhaltet die Parameter der Berechtigung.

Dokumente im Aktenkonto werden mittels ihrer XDS-Metadaten identifiziert. Die Nutzungsvorgaben für XDS-Metadaten zur
Kennzeichnung von Policy Documents sind in [gemSpec_DM_ePA#A_14961-*] beschrieben.

Das Ergebnis der Suchanfrage query:AdhocQueryResponse_Message liefert, falls Berechtigungen erteilt wurden, die XDS-
Metadaten von einem oder mehreren Policy Documents (je ein Policy Document pro LEI, KTR, DiGA bzw. Vertreter). Die XDS-
Metadaten beinhalten die eindeutigen Kennungen (DocumentEntry.uniqueId) der Policy Documents. Mittels dieser werden die
Policy Documents im nächsten Schritt aus der Dokumentenverwaltung heruntergeladen.

Als Ergebnis liegen, falls Berechtigungen erteilt wurden, ein oder mehrere AuthorizationKeys sowie Policy Documents für
berechtigte LEI, KTR, DiGA und für Vertreter vor.

Gemäß der Beschreibung in "" können folgende Informationen zu den Berechtigungen aus den Policy Documents bzw. den XDS-
Metadaten ermittelt werden.

Berechtigung für LEI: Telematik-ID, Name der LEI, Berechtigung "erteilt am", Berechtigung "gültig bis", Zugriffsrecht
der LEI berechtigte Dokumentenkategorien, einzeln freigeschaltete oder geblockte Dokumente (Allowlist, Denylist)

Gemäß der Beschreibung in "" können folgende Informationen zu den Berechtigungen aus den AuthorizationKeys ermittelt
werden.

Berechtigung für Vertreter: Versicherten-ID, Name des Vertreters

Berechtigung für KTR: Telematik-ID, Name des KTR

Berechtigung für DiGA: Telematik-ID, Name der DiGA

Die Policy Documents lassen sich auf Basis der Versicherten-ID des Vertreters bzw. der Telematik-ID der LEI, DiGA oder
KTR den AuthorizationKeys zuordnen.

## 6.2.3.8 AuthorizationKey

Der AuthorizationKey enthält Parameter zur Berechtigung sowie die für den Berechtigten verschlüsselten Akten- und
Kontextschlüssel.

## 6.2.3.8.1 Struktur AuthorizationKeyType

Die Struktur AuthorizationKeyType ist in [AuthorizationService.xsd] beschrieben.

Das Attribut validTo beinhaltet die Gültigkeit des AuthorizationKey, d.h. den Zeitpunkt bis zu dem die Berechtigung
erteilt wird. Für eine Berechtigung ohne zeitliche Begrenzung wird ein technisches Datum (31.12.9999) verwendet.

Das Attribut actorID beinhaltet die ID des Berechtigenden, d.h. die Versicherten-ID für Aktenkontoinhaber und Vertreter
bzw. die Telematik-ID für LEIs, DiGA und KTR.

Das Element DisplayName beinhaltet den Klartextnamen des Berechtigten oder den Namen der berechtigten DiGA.

Das Element AuthorizationType beinhaltet den Berechtigungstyp. Siehe auch .

Das Element phrs:AuthorizationKey/phrs:EncryptedKeyContainer enthält das Chiffrat mit dem verschlüsselten Akten- und
Kontextschlüssel sowie AssociatedData.

Die Datenstruktur für EncryptedKeyContainer und die Klartextpräsentation für Akten- und Kontextschlüssel ist in 
beschrieben.

## 6.2.3.8.2 Schlüsselableitung für Ver- und Entschlüsselung

Die Klartextpräsentation von Akten- und Kontextschlüssel im AuthoritationKey ist doppelt symmetrisch verschlüsselt. Die
symmetrischen Schlüssel zur Ver- und Entschlüsselung von Akten- und Kontextschlüssel werden über die
Schlüsselableitungsfunktion der Schlüsselgenerierungsdienste Typ 1 und 2 ermittelt. Die Funktionsweise der
Schlüsselgenerierung wird in [gemSpec_SGD_ePA] beschrieben.

Im Schritt 7 des Basisablaufs erfolgt der Aufruf für KeyDerivation abhängig vom Anwendungsfall:

|========================================================================================================================|
|Anwendungsfall im FdV       |Akteur      |Zweck         |Anwendungsfall für SGD                                         |
|============================|============|==============|===============================================================|
|Aktenkonto aktivieren<br>   |Versicherter|Verschlüsseln |                                                               |
|Anbieter wechseln           |            |              |                                                               |
|----------------------------|------------|--------------|---------------------------------------------------------------|
|Berechtigung für LEI        |Versicherter|Verschlüsseln |                                                               |
|vergeben<br>Vertretung      |            |              |                                                               |
|einrichten<br>Berechtigung  |            |              |                                                               |
|für Kostenträger vergeben   |            |              |                                                               |
|<br>Berechtigung für DiGA   |            |              |                                                               |
|vergeben<br>Berechtigung für|            |              |                                                               |
|LEI ändern                  |            |              |                                                               |
|----------------------------|------------|--------------|---------------------------------------------------------------|
|Berechtigung für LEI        |Vertreter   |Verschlüsseln |                                                               |
|vergeben<br>Berechtigung für|            |              |                                                               |
|Kostenträger vergeben<br>   |            |              |                                                               |
|Berechtigung für DiGA       |            |              |                                                               |
|vergeben<br>Berechtigung für|            |              |                                                               |
|LEI ändern                  |            |              |                                                               |
|----------------------------|------------|--------------|---------------------------------------------------------------|
|Login                       |Versicherter|Entschlüsseln |Für das Entschlüsseln müssen keine Anwendungsfälle für SGD     |
|                            |<br>        |              |unterschieden werden. <br>Es wird das Element AssociatedData   |
|                            |Vertreter   |              |des ermittelten AuthorizationKey für den Aufruf der            |
|                            |            |              |Operation KeyDerivation beim SGD wie folgt verwenden:<br>      |
|                            |            |              |KeyDerivation <Teilstring aus AssociatedData für den           |
|                            |            |              |entsprechenden SGD>                                            |
|========================================================================================================================|

Als Ergebnis bei einer erfolgreichen Schlüsselableitung zum Verschlüsseln erhält das ePA-FdV von jedem der beiden
SGD eine Antwortnachricht für KeyDerivation im Format: "OK-KeyDerivation "+Key+" "+a

Key ist der für die Verschlüsselung zu verwendende symmetrische Schlüssel und a entspricht AssociatedData für den
entsprechenden SGD.

Zur Optimierung der Performance muss das ePA-FdV die Schlüsselableitung für SGD 1 (Basisablauf Schritt 1) und SGD 2
(Basisablauf Schritt 3) und das Erzeugen eines ephemeren ECDH-Schlüsselpaares (Basisablauf Schritt 5) parallel
ausführen. Der Request an SGD 1 und SGD 2 in Basisablauf Schritt 7 können ebenfalls parallelisiert werden. Die bei einer
Schlüsselableitung für eine Entschlüsselung im Request für KeyDerivation zu übermittelnden Informationen werden sowohl
für SGD 1 als auch SGD 2 dem Element phrs:AuthorizationKey/phrs:EncryptedKeyContainer/phrs:AssiciatedData entnommen.

Siehe auch .

## 6.2.3.8.3 AuthorizationKey erstellen

Für den Aktenkontoinhaber, Vertreter, DiGA und KTR wird die Berechtigung ohne zeitliche Begrenzung vergeben. Für LEI ist
das Enddatum entsprechend der vom Nutzer gewählten Berechtigungsdauer zu setzen. Der für DisplayName zu verwendende Name
einer LEI, einer DiGA oder eines KTR und die Telematik-ID werden aus dem Eintrag der zu berechtigenden Institution im
VZD bestimmt (siehe "").

Es werden bei der Autorisierung verschiedene Berechtigungstypen unterschieden. Siehe . Für Aktenkontoinhaber, Vertreter,
LEIs, DiGA und KTR wird immer ein Berechtigung mit Zugriff auf die Dokumente vergeben.

Akten- und Kontextschlüssel werden mit den in der Schlüsselableitung erhaltenen Schlüssel symmetrisch verschlüsselt. Es
gelten die Vorgaben aus  sowie .

## 6.2.3.8.4 AuthorizationKey entschlüsseln

Der AuthorizationKey für einen Versicherten (Aktenkontoinhaber oder Vertreter) enthält ein verschlüsseltes Schlüsselpaar
(Akten- und Kontextschlüssel).

Der Aktenschlüssel wird benötigt, um die Dokumente aus dem ePA-Aktensystem zu ver- und entschlüsseln. Der
Kontextschlüssel wird benötigt, um den Verarbeitungskontext der Dokumentenverwaltung zu öffnen.

Das Chiffrat phrs:AuthorizationKey/phrs:EncryptedKeyContainer/phrs:CipherText ist doppelt symmetrisch verschlüsselt. Die
für die Entschlüsselung des Chiffrats benötigten zwei AES-256-Schlüssel ruft das FdV von den
Schlüsselgenerierungsdiensten Typ 1 und Typ 2 gemäß [gemSpec_SGD_ePA] ab. Siehe " ". 

Es gelten für das Entschlüsseln die Vorgaben aus  sowie .

## 6.2.3.9 Schlüsselmaterial aus ePA-Aktensystem laden

Mit dieser Operation wird die Autorisierung eines Nutzers des FdV für ein Aktenkonto geprüft und die Schlüssel eines
berechtigten Nutzers (bspw. Aktenkontoinhaber, berechtigter Vertreter, LEI) für den Zugriff auf die Dokumentenverwaltung
heruntergeladen.

Besitzt der Nutzer, für den das Schlüsselmaterial angefragt wird, keine Autorisierung für den Zugriff auf das
Aktenkonto, dann beinhaltet die Response den Fehler KEY_ERROR.

Wird versucht das Schlüsselmaterial für den Aktenkontoinhaber herunterzuladen und beinhaltet der Response eine
AuthorizationAssertion aber kein AuthorizationKey, dann ist das Aktenkonto des Versicherten noch nicht aktiviert. Das
Aktivieren kann über die Anwendungsfälle "Aktenkonto aktivieren" oder "Anbieter wechseln" erfolgen.

## 6.2.3.10 Schlüsselmaterial aller Berechtigten aus ePA-Aktensystem laden

Mit dieser Operation wird das Schlüsselmaterial für alle Berechtigten des Aktenkontos heruntergeladen. Im Response
werden keine AuthorizationAssertion übertragen.

## 6.2.3.11 Schlüsselmaterial im ePA-Aktensystem speichern

Mit dieser Operation wird Schlüsselmaterial (AuthorizationKey) für den Aktenkontoinhaber, einen Vertreter oder eine LEI
in der Komponente Autorisierung des ePA-Aktensystems gespeichert. Beim Operationsaufruf für einen Vertreter wird eine
Benachrichtigungsadresse (E-Mail) für die Geräteautorisierung hinterlegt (Parameter NotificationInfoRepresentative).

Wenn die Operation den Fehler KEY_ERROR meldet, dann ist bereits ein Schlüssel in der Autorisierung hinterlegt. Dies
kann bspw. bei einer Berechtigung der Fall sein, wenn die Berechtigung bereits zuvor erfolgreich erteilt wurde, oder
wenn bei einem vorherigen Versuch die Berechtigung einzurichten ein Fehler auftrat, nachdem Schlüsselmaterial
erfolgreich hinterlegt wurde (bspw. das zugehörige Policy Document nicht erfolgreich in der Dokumentenverwaltung
hinterlegt werden konnte).

## 6.2.3.12 Schlüsselmaterial im ePA-Aktensystem ersetzen

Mit dieser Operation wird vorhandenes Schlüsselmaterial (AuthorizationKey) für den Aktenkontoinhaber, einen Vertreter
oder eine LEI in der Komponente Autorisierung des ePA-Aktensystems ersetzt.

## 6.2.3.13 Schlüsselmaterial im ePA-Aktensystem löschen

Mit dieser Operation wird vorhandenes Schlüsselmaterial (AuthorizationKey) für einen Vertreter oder eine LEI in der
Komponente Autorisierung des ePA-Aktensystems gelöscht.

## 6.2.3.14 Leistungserbringerinstitution im Verzeichnisdienst der TI finden

Informationen zu Leistungserbringern und Leistungserbringerinstitutionen sind im Verzeichnisdienst (VZD) der TI-
Plattform hinterlegt. Der Nutzer der FdV kann (bspw. für die Vergabe von Berechtigungen an LEI) mit verschiedenen
Kriterien nach LE und LEI im VZD suchen und Informationen abrufen. Das Informationsmodell des Verzeichnisdienstes ist in
[gemSpec_VZD#5] beschrieben.

Die Suche nach LE oder LEIs erfolgt primär über den Namen oder Institutionennamen aber auch über zusätzliche
Informationen wie Adressen, Fachgebiet oder Institutionstyp.

Da nur Leistungserbringerinstitutionen und keine einzelnen Leistungserbringer für den Zugriff auf ein Aktenkonto
berechtigt werden können, müssen die durch den Nutzer eingegebenen Suchparameter ggf. für die VZD-Abfrage so ergänzt
werden, dass nur Informationen zu Leistungserbringerinstitutionen abgefragt werden. Dies kann anhand des Parameters
entryType=3 oder, wenn spezifischere Informationen zur Art der Leistungserbringerinstitution vorliegen, über den
Parameter professionOID im Wertebereich gemäß [gemSpec_VZD#Tab_VZD_Mapping_Eintragstyp Eingangstyp 3] erfolgen.

Die VZD-Abfrage wird gemäß der übergreifenden Aktivität "Suchanfrage Verzeichnisdienst der TI" durchgeführt.

## 6.2.3.15 DiGA im Verzeichnisdienst der TI finden

Informationen zu DiGAs sind im Verzeichnisdienst (VZD) der TI-Plattform hinterlegt. Der Nutzer der FdV kann (bspw. für
die Vergabe von Berechtigungen an eine DiGA) mit verschiedenen Kriterien nach DiGAs im VZD suchen und Informationen
abrufen. Das Informationsmodell des Verzeichnisdienstes ist in [gemSpec_VZD#5] beschrieben.

Das Ergebnis kann eine Liste von Apps unterschiedlicher Hersteller sein, aus welcher der Versicherte diejenige DiGA
auswählt, die er berechtigen möchte. Eine genauere Eingrenzung der Suchergebnisse kann am FdV über organizationName
(Name des DiGA-Herstellers) und commonName (Name der DiGA) erfolgen.

Das Verschlüsselungszertifikat im Ergebnis der Abfrage beinhaltet die Telematik-ID des zu berechtigenden DiGA-
Herstellers und den Namen der DiGA.

## 6.2.3.16 Suchanfrage Verzeichnisdienst der TI

Der VZD der TI ist für Suchoperationen des ePA-Frontend des Versicherten  über das Zugangsgateway des Versicherten
erreichbar, welches als LDAP-Proxy agiert. Das ePA- FdV nutzt zur Abfrage des VZD den Standard Directory Services Makeup
Language v2.0 [DSML2.0].

Für das Datenmodell des LDAP-Verzeichnis siehe [gemSpec_VZD].

Für ein Beispiel für eine Suchanfrage und ein Ergebnis siehe .

Die Anzahl der Einträge im Ergebnis der Suchabfrage wird durch den VZD beschränkt. (siehe ) 

Die Anzahl der möglichen Anfragen an den Verzeichnisdienst ist begrenzt (default: 10 Anfragen pro Minute). Wird die
Anzahl überschritten, beinhaltet der HTTP-Response des Zugangsgateway des Versicherten den HTTP-Statuscode 429
entsprechend RFC6585 Kapitel 4 "429 Too Many Requests". Der Response mit dem HTTP-Statuscode 429 stellt keinen Fehler
dar. Der Anwendungsfall wird nicht abgebrochen. Das FdV muss den Nutzer informieren, dass der nächste Request erst nach
einer Verzögerung möglich ist.

Die im dsmlEnvelopeResponse gelieferten Informationen beinhalten die Informationen zum Name der Institution und
Verschlüsslungszertifikate, welche für die Vergabe von Berechtigungen weiterverarbeitet werden.

Der Name einer Institution oder einer DiGA wird aus dem Basisdatensatz Attribut displayName bestimmt. Die Telematik-ID
einer Institution oder einer DiGA wird aus einem Verschlüsselungszertifikat des Datensatzes bestimmt (siehe
[gemSpec_PKI]).

## 6.2.3.17 PIN-Eingabe für eGK durch Nutzer

Mit dieser Operation wird der Nutzer zur fachlich motivierten PIN-Eingabe für seine eGK aufgefordert.

Zusätzlich kann bei Nutzung einer eGK eine PIN-Eingabe für die Berechtigung zum Zugriff auf Daten auf der eGK notwendig
sein. In dem Fall wird die Aufforderung zur PIN-Eingabe durch den CardProxy ausgelöst.

## 6.2.4 Nutzerzugang ePA

## 6.2.4.1 Login Aktensession

Mit diesem Anwendungsfall wird die Aktensession eines Nutzers im FdV gestartet. Der Sessionstart erfolgt implizit, falls
die Verbindung zum ePA-Aktensystem bei Ausführung eines fachlichen Anwendungsfalls der ePA erforderlich ist und nicht
besteht oder explizit beim Start des FdV durch den Nutzer.

Für die Anmeldung des Nutzers mit seiner eGK wird eine 2-Faktor-Authentisierung (eGK + PIN) verwendet. Als weitere
Möglichkeit kann die alternative kryptographische Versichertenidentität genutzt werden. Nach erfolgreicher
Authentisierung inklusive Gültigkeitsprüfung der eGK und Autorisierung wird das empfängerverschlüsselte
Schlüsselmaterial heruntergeladen und das Öffnen des Aktenkontextes in der Komponente "Dokumentenverwaltung" für das
referenzierte Aktenkonto durchgeführt.

Bei der Anmeldung eines Nutzers als Vertreter oder bei der Anmeldung des Versicherten bei seinem alten Aktensystem
während des Anbieterwechsels erfolgt das Login immer explizit. Dabei unterstützt das ePA-Frontend des Versicherten den
Benutzer bei der Auswahl des Aktensystems des zu Vertretenen.

![img](3548985913363942882.]

Abbildung #: Aktivitätsdiagramm "Login Aktensession"

Gültige Session-Daten liegen vor, wenn die Session-Daten einen Authentisierungstoken und einen Autorisierungstoken
beinhalten. Auf eine Prüfung der zeitlichen Gültigkeit der Token wird verzichtet, da eine Synchronität der Systemzeit in
der Ablaufumgebung des ePA-FdV mit der den Token ausstellenden Komponente nicht sichergestellt werden kann. Antwortet
das ePA-Aktensystem auf einen Operationsaufruf mit dem Fehler, dass ein Token ungültig ist, dann löscht das ePA-FdV die
Token aus den Session-Daten (siehe [A_15310-01]A_15310-01). 

Authentisieren und Autorisieren

Während der Entschlüsselung des Akten-und Kontextschlüssels werden Zertifikate der TI geprüft. Zuvor ist die Aktualität
des Vertrauensraumes der TI sicher zu stellen. Siehe "".

Aktivieren und Migration

Wenn die Autorisierung eine AuthorizationAssertion aber kein AuthorizationKey liefert, dann ist das Aktenkonto des
Versicherten noch nicht aktiviert. Das Aktivieren kann über die Anwendungsfälle "Aktenkonto aktivieren" oder "Anbieter
wechseln" erfolgen.

Der Status des Aktenkontos (RecordState) lässt sich aus dem Autorisierungstoken Attribut
Assertion/AttributeStatement/Attribute mit dem Namen "Zustand des Kontos" ermitteln. Die Information wird in die
Session-Daten übernommen.

Dem Nutzer soll im Falle dieses Abbruchs ein Hinweis gegeben werden, dass vor der Nutzung des Aktenkontos beim neuen
Anbieter eine Migration der Daten aus dem Aktenkonto des alten Anbieters durchgeführt werden muss.

Verbindung zur Dokumentenverwaltung

Für die Aktivität "Aktenkonto öffnen" wird zuerst ein sicherer Kanal auf Inhaltsebene zwischen dem ePA-FdV und der VAU
der Dokumentenverwaltung aufgebaut. Dafür wird die Schnittstelle I_Document_Management_Connect der Komponente
Dokumentenverwaltung genutzt (siehe auch ).

Das ePA-FdV nutzt den abgeleiteten Sitzungsschlüssel, um alle fachlichen Eingangs- und Ausgangsnachrichten zur
Dokumentenverwaltung zu ver- bzw. entschlüsseln. Siehe [A_15304-01]A_15304-01.

Benachrichtigungen

Die Anzeige von Benachrichtigungen im Anwendungsfall "Login Aktensession" ist optional gemäß den Konfigurationsdaten.
Wird das Login nicht explizit mit dem Start des FdV ausgeführt, sondern erst bei Ausführung eines Anwendungsfalls mit
Zugriff auf das ePA-Aktensystem, dann muss der Nutzer zuerst bestätigen, ob die Benachrichtigungen innerhalb des
aufgerufenen Anwendungsfalls angezeigt werden sollen.

Es gilt die folgende Anforderung aus dem Anwendungsfall "Protokolldaten einsehen" für die Darstellung der
Benachrichtigung: "".

## 6.2.4.2 Logout Aktensession

Dieser Anwendungsfall beendet eine Aktensession.

Eine Beschreibung der signaturdienstspezifischen Schnittstelle für diese Operation ist in [vesta].

Die Session-Daten sind in "" beschrieben.

## 6.2.5 Aktenkontoverwaltung

## 6.2.5.1 Aktenkonto aktivieren

Der Anwendungsfall "Aktenkonto aktivieren" wird automatisch gestartet, wenn sich beim Login nach der Autorisierung
ergibt, dass das Aktenkonto den Status "REGISTERED" hat.

Der Anwendungsfall kann in der GUI auswählbar sein. Dann ist vorab der Anwendungsfall "Login Aktensession" auszuführen.

Im Rahmen des Login wird eine Authentisierung und Autorisierung des Nutzers durchgeführt.

Für das Erzeugen von Schlüsseln ist  und  zu beachten.

Nach erfolgreichem Aufruf dieser Operation hat das Aktenkonto den Status aktiviert. Die folgenden Aktivitäten
ermöglichen, dass der Nutzer ohne erneutes Login fachliche Anwendungsfälle (bspw. Berechtigung vergeben, Dokument
einstellen) mit dem Aktenkonto ausführen kann.

Das Laden des Schlüsselmaterial aus ePA-Aktensystem laden erfolgt gemäß [A_15344-01]A_15344-01.

Das Öffnen des Aktenkontext erfolgt gemäß [A_15347-01]A_15347-01 und [A_15348-01]A_15348-01.

## 6.2.5.2 Anbieter wechseln

Ein Versicherter kann mit diesem Anwendungsfall den Anbieter seines Aktenkontos wechseln und alle Inhalte zu einem neuen
Anbieter übertragen. Hierfür sind mehrere Aktionen durch den Versicherten durchzuführen.

   - Kündigung des bestehenden Aktenkontos beim alten Anbieter
   - Registrierung eines neuen Aktenkontos bei einem neuen Anbieter
   - Bestätigung vom neuen Anbieter erhalten, dass das neue Aktenkonto zur Datenübernahme vorbereitet ist
   - Übernahme der Daten vom Aktenkonto des alten Anbieters zum neuen Anbieter im FdV

Die Anzeige der zugriffsberechtigten LEIs und, Vertreter erfolgt mittels Anwendungsfall "Vergebene Berechtigungen
anzeigen". Das Ergebnis der Operation I_Authorization_Management_Insurant::getAuthorizationList wird im weiteren Verlauf
für die Einrichtung der Berechtigungen im neuen Aktenkonto genutzt.

![img](7356014187457167109.]

Abbildung #: Aktivitätsdiagramm "Anbieter wechseln"

Nachdem das Aktenkonto den Zustand SUSPENDED ("bereit für Anbieterwechsel") erhalten hat, kann der Versicherte oder ein
berechtigter Nutzer nicht mehr auf das Aktenkonto zugreifen.

Das Authentisieren des Nutzers erfolgt mittels der übergreifenden Aktivität "Authentisieren des Nutzers".

Die Autorisierung des Nutzers erfolgt gemäß [A_15344-01]A_15344-01. Die Operation getAuthorizationKeys liefert
ein Autorisierungstoken mit RecordState = REGISTERED_FOR_MIGRATION und kein Schlüsselmaterial.

Der Aufbau des sicheren Kanals zur Dokumentenverwaltung erfolgt gemäß A_15347-*.

Das Öffnen des Aktenkontextes erfolgt gemäß [A_15348-01]A_15348-01  unter Nutzung des Autorisierungstoken
mit RecordState = REGISTERED_FOR_MIGRATION und dem Kontextschlüssel des Aktenkontos des alten Anbieters.

Hinweis: Das ENC-VAU-Zertifikat des Betreibers darf im ePA-FdV persistent gespeichert werden.

Die bestehenden Berechtigungen werden in das ePA-Aktensystem des neuen Anbieters übernommen.

Die Berechtigung für einen Vertreter kann nur übernommen werden, wenn dem Versicherten die E-Mailadresse des Vertreters
für die Geräteautorisierung bekannt ist. Hierbei wird davon ausgegangen, dass es sich bei dem Vertreter um eine
Vertrauensperson handelt und der Versicherte die Daten kennen könnte. Anderenfalls kann die Berechtigung für den
Vertreter nicht übernommen werden und muss mittels dem Anwendungsfall "Vertretung einrichten" zusammen mit dem Vertreter
neu eingerichtet werden.

Das Hochladen des Schlüsselmaterials in das ePA-Aktensystem erfolgt mit der übergreifende Aktivität "Schlüsselmaterial
im ePA-Aktensystem speichern" mit dem EingangsparameterAuthorizationKey = erstellter AuthorizationKey. Der optionale
Parameter NotificationInfoRepresentative wird für LEI, DiGA und KTR nicht belegt.

Die Information, welche Geräte durch Nutzer autorisiert sind, wird nicht übertragen. D.h. der Nutzer muss bei der
nächsten Anmeldung am Aktenkonto des neuen Anbieters sein GdV autorisieren.

Der Vorgang des Anbieterwechsels erfolgt aktensystemseitig asynchron, d. h. die Operation ist aus Sicht des FdV nach
kurzer Zeit abgeschlossen, läuft im Backend jedoch weiter. Der Nutzer ist darauf hinzuweisen, dass er Zugriff auf sein
Aktenkonto erst nach Abschluss der Datenmigration erhalten kann und dass diese länger dauern kann.

## 6.2.5.3 Schließen einer Akte

Der Versicherte hat jederzeit das Recht, seine ePA endgültig zu schließen.

## 6.2.6 Umschlüsselung

Dieses Kapitel beschreibt den Anwendungsfall Umschlüsselung. In den folgenden Abbildungen ist in einem Sequenzdiagramm
der Ablauf der Umschlüsselung mit den einzelnen Akteuren ePA-FdV, Autorisierung, Dokumentenverwaltung und SGD1/2
dargestellt. Grün eingefärbte Pfeile bezeichnen signierte Rückgabewerte. Die Signaturen werden bei der Weiterleitung der
Rückgabewerte mit an den Empfänger geleitet. Dieser validiert nach Empfang des Wertes und der Signatur diese auf
Gültigkeit und darauf, dass der Signaturerstellungszeitpunkt nicht zu weit in der Vergangenheit liegt.

![img](7789330529684110977.]

Abbildung #: Umschlüsselung I

![img](6381640132599338126.]

Abbildung #: Umschlüsselung II

![img](14074445959304207629.]

Abbildung #: Umschlüsselung III

![img](18384869598994544497.]

Abbildung #: Umschlüsselung IV

Wenn das Frontend des Versicherten auf einem Smartphone läuft, dann kann es durchaus die Verbindung in einem Funkloch
verlieren und nach kurzer Zeit wieder herstellen. Weiterhin kann es sein, dass das Smartphone sich wegen erschöpften
Akkumulators abschaltet und der Nutzer es innerhalb kurzer Zeit an das Ladegerät anschließt und die Umschlüsselung
fortsetzen möchte. Diese Verbindungsabbrüche sollen nicht zum Abbrechen des Umschlüsselungsprozesses  führen.

Die Komponenten Autorisierung und Dokumentenverwaltung führen nach Erhalt der Nachricht finishKeyChange(FALSE) die
Methode Rollback() durch und stellen den Zustand von vor der Umschlüsselung wieder her.

Das Aktensystem lehnt im Zustand KEY_CHANGE alle sonstigen Aktivitäten vom FdV ab, daher sollte das FdV dem Benutzer
auch keine weiteren Aktivitäten anbieten.

## 6.2.7 Berechtigungsverwaltung

Dieses Kapitel beschreibt Anwendungsfälle zur Vergabe und Administration von Berechtigungen zum Zugriff auf das
Aktenkonto.

Im FdV können nur Berechtigungen an LEI und DiGA vergeben werden, die im Verzeichnisdienst (VZD) der TI registriert
sind.

Die zulässigen Berechtigungsvergaben für die verschiedenen Leistungserbringerinstitutionen, Kostenträger, DiGA und
Vertreter werden vom Aktensystem durchgesetzt. Das ePA-Frontend des Versicherten kann die grundsätzlich gesetzlich
möglichen Berechtigungsvergaben nicht erweitern, sondern nur weiter einschränken.

Die Anzeige kann z.B. als Hilfetext vom Nutzer bei der Berechtigungsvergabe erreichbar sein.

Für die Umsetzung der Suche siehe " ". 

Für Informationen zu Policy Documents und deren Nutzungsvorgaben siehe "".

Damit kann der Versicherte vor dem Besuch einer Leistungserbringerinstitution kontrollieren, auf welche Dokumente
die Leistungserbringerinstitution lesenden bzw. löschenden Zugriff während der Behandlung hat.

## 6.2.7.1 Spezifische Zugriffsregeln

Das Aktensystem setzt folgende Regeln um: Die kategorienbasierte Berechtigung in Form eines Policy Document berechtigt
eine LEI abhängig von den Zugriffsunterbindungsregeln auch zum Einstellen eines Dokuments. Diese Autorisierung kann über
Vertraulichkeitsstufen weiter eingeschränkt werden. Der lesende Zugriff auf Dokumente und Ordner kann weiterhin
feingranular gewährt oder entzogen werden ("Allowlisting" und "Denylisting).

## 6.2.7.1.1 kategorienbasierte Berechtigung

Bei der kategorienbasierten Berechtigung wird der Zugriff auf die vorhandenen Dokumente der elektronischen Patientenakte
in Dokumentenkategorien organisiert. Diese sind in der Spezifikation gemSpec_DM_ePA aufgeführt. Die Zuordnung eines
einzelnen Dokumentes zu einer einzelnen Dokumentenart legt (mit Ausnahme der Dokumentenarten Dokumente des Versicherten,
 Dokumente einer DiGA und der Kostenträgerdokumente) die ePA-Dokumentenverwaltung fest. Alle Dokumente, die der
Versicherte selbst einstellt, sind immer der Kategorie Dokumente des Versicherten zugeordnet.  Eine DiGA kann
ausschließlich DiGA-Dokumente einstellen. Ein Kostenträger kann ausschließlich Kostenträgerdokumente einstellen.<br>
Der Versicherte kann über das ePA-Frontend des Versicherten einer einzelnen Leistungserbringerinstitution den Zugriff
auf einzelne Dokumentenkategorien erteilen oder entziehen.

Wenn die Nutzerin des ePA-Frontend des Versicherten als Leistungserbringerinstitution eine Hebamme auswählt, dann hat
diese weniger mögliche Zugriffsrechte als zum Beispiel ein Hausarzt. Das  ePA-Frontend des Versicherten darf dann für
die Hebamme nur die nach [gemSpec_Dokumentenverwaltung#Tab_Dokv_030 - Zugriffsunterbindungsregeln] möglichen
Berechtigungen anzeigen.

Damit kann der Nutzer vor dem Besuch einer Leistungserbringerinstitution sehen, welche Dokumentenkategorien der ePA bei
der LEI sichtbar sind.

Ein Dokument kann sich in einer Dokumentenkategorie befinden, für die eine
Leistungserbringerinstitution zugriffsberechtigt ist, über die dokumentenspezifische Berechtigung könnte der
Leistungserbringerinstitution hingegen der Zugriff auf dieses Dokument entzogen worden sein. Im Resultat wird von der
ePA-Dokumentenverwaltung durchgesetzt, dass diese Leistungserbringerinstitution keinen Zugriff auf das Dokument hat. 

Bei der kategorienbasierten Berechtigung kann der Zugriff auf die vorhandenen Dokumente einer Dokumentenkategorie
weiterhin in drei Vertraulichkeitsstufen näher festgelegt werden. Dabei werden die Vertraulichkeitsstufen normal,
vertraulich und streng vertraulich verwendet. Eine einzelne Leistungserbringerinstitution kann entweder Zugriff auf alle
Dokumente der Vertraulichkeitsstufe normal oder auf die Vertraulichkeitsstufen normal und vertraulich erhalten. Es ist
auch möglich, einen generellen Zugriff auf diese beiden oder einer der beiden Vertraulichkeitsstufen zu vergeben. Dazu
müssen in einer Autorisierung zusammen mit einer Vertraulichkeitsstufe alle Dokumentenkategorien für einen Zugriff
ausgewählt werden.

Der Zugriff auf Dokumente der Vertraulichkeitsstufe streng vertraulich ist der Leistungserbringerinstitution nur dann
möglich, wenn eine gesonderte Freigabe über eine Allowlist vorgenommen wird.

Eine einmal getroffene Entscheidung bezüglich der Zuordnung eines Dokumentes zu einer Vertraulichkeitsstufe und
bezüglich des Zugriffs einer Leistungserbringerinstitution kann vom Versicherten durch das ePA-Frontend des Versicherten
jederzeit revidiert werden. 

Beim Aufruf von I_Document_Management_Insurant::RestrictedUpdateDocumentSet muss immer für "previousVersion" in der
Nachricht der Wert "1" angegeben werden, da der Aufruf seitens der ePA-Dokumentenverwaltung nicht für eine echte
Versionierung des alten Dokuments genutzt wird. Serverseitig wird DocumentEntry.version entsprechend nicht verwaltet und
besitzt standardmäßig deshalb immer den impliziten Wert 1.

Das Abspeichern des Defaultwertes erfolgt lokal im ePA-FdV, d.h. bei Nutzung eines weiteren Gerätes ist dieser
Defaultwert nicht bekannt.

Eine Leistungserbringerinstitution, welche das einfache Zugriffsrecht erteilt wurde, hat nur Zugriff auf Dokumente in
der ePA mit der Vertraulichkeitsstufe normal. Eine Leistungserbringerinstitution, welcher das erweitere Zugriffsrecht
erteilt wurde, hat nur Zugriff auf Dokumente in der ePA mit den Vertraulichkeitsstufen normal und vertraulich.  

Mögliche Anzeigen wäre z. B: "LEI hat erweitertes Zugriffsrecht mit Freigabe der Kategorie Arztbrief und wurde nicht
explizit einzeln ausgeschlossen.", "LEI hat explizite Einzelfreigabe für dieses Dokument.", "LEI hat kein Zugriffsrecht
für dieses Dokument"

## 6.2.7.1.2 Dokumentenspezifische Berechtigung

Bei der dokumentenspezifischen oder feingranularen Berechtigung wird der Zugriff einer Leistungserbringerinstitution auf
die vorhandenen Dokumente der elektronischen Patientenakte auf der Ebene einzelner Dokumente organisiert. Dazu erzeugt
das ePA Frontend des Versicherten für jedes freizugebende Dokument (d.h. intern pro documentEntry.entryUUID) einen
Eintrag auf einer sogenannten Allowlist, um einen Zugriff zu gewähren. Ein explizites Verbot kann der Versicherte über
eine sogenannte Denylist aussprechen. Auf einer Allow- oder Denylist kann auch ein Ordner (d.h. intern pro Folder.
entryUUID) der Sammlungstypen uniform und mixed stehen, um z.B. bei potentiell mehreren Pässen spezifische Zugriffe zu
untersagen (welche u.U. durch eine Freigabe über die Dokumentenkategorien möglich wären).  Beim Aktualisieren der
Allowlist- oder Denylist-Einträge muss das ePA-Frontend des Versicherten sicherstellen, dass diese Policies keine
widersprüchlichen Einträge enthalten.

## 6.2.7.2 Vertretung einrichten

Mit diesem Anwendungsfall richtet ein Versicherter (Aktenkontoinhaber) eine Zugriffsberechtigung für einen Vertreter
ein. Dieser Vertreter muss über eine eigene gültige eGK verfügen und den PIN seiner eGK kennen oder eine alternative
Authentisierung für ein geeignetes FdV auf seinem GdV eingerichtet haben. Der Anwendungsfall steht einem berechtigten
Vertreter nicht zur Verfügung.

Zur Verbesserung des Datenschutzes muss die Vertretung zusätzlich über eine E-Mail durch den Versicherten bestätigt
werden.

Vor der Berechtigung müssen der Name, die Versicherten-ID sowie die E-Mailadresse des Vertreters für die
Geräteautorisierung erfasst werden.

Die Berechtigungsdauer für Vertreter kann nicht zeitlich oder inhaltlich begrenzt werden. Wenn ein Vertreter berechtigt
ist, auf die Dokumente zuzugreifen, dann kann der Vertreter dauerhaft auf alle Dokumente im Aktenkonto zugreifen, bis
ihm die Berechtigung generell wieder entzogen wird.

Falls der Vertreter die Vertretung nicht ausschließlich in einer LEI sondern auch an einem FdV wahrnehmen möchte, muss
in der folgende Aktivität die Benachrichtigungsadresse des Vertreters für die Geräteautorisierung an das Aktensystem
übergeben werden, da der Vertreter sich ansonsten von seinem FdV nicht autorisieren kann. 

Für Informationen zu Policy Documents und deren Nutzungsvorgaben siehe " ".

Dem Versicherten kann ein Hinweis angezeigt werden, dass zum Abschluss eine Autorisierung der Vertretung über eine E-
Mail erfolgen muss, welche dem Versicherten vom Aktensystem zugesandt wird. 

Nach der Einrichtung der Vertretung teilt der Versicherte dem Vertreter die Informationen mit, welche der Vertreter in
seinem FdV konfigurieren muss, um auf das Aktenkonto zugreifen zu können. Diese Informationen können der Konfiguration
des ePA-FdV entnommen werden.

Zur Unterstützung kann das FdV bspw. zusätzlich eine E-Mail (an die Benachrichtigungsadresse zur Geräteautorisierung)
bereitstellen, um die Informationen zu übermitteln.

## 6.2.7.3 Berechtigung für Kostenträger vergeben

Mit diesem Anwendungsfall richtet ein Versicherter oder ein berechtigter Vertreter Zugriffsberechtigungen auf das
Aktenkonto für einen Kostenträger ein. Der Zugriff eines KTR ist auf das Einstellen und Aktualisieren von Dokumenten
beschränkt.

Für Informationen zu Policy Documents und deren Nutzungsvorgaben siehe "".

## 6.2.7.4 Vergebene Berechtigungen anzeigen

Mit diesem Anwendungsfall kann ein Nutzer eine Liste der für das Aktenkonto vergebenen Berechtigungen anzeigen lassen.
Diese Liste beinhaltet die zugriffsberechtigten Leistungserbringer, die berechtigten Vertreter und zugriffsberechtigte
Kostenträger sowie die Details zu Berechtigungen (für LEI: Berechtigungsdauer, Zugriff auf durch den Versicherten
eingestellte Dokumente).

Das Ergebnis der Suche soll für den Nutzer sortierbar und filterbar dargestellt werden.

Das lokale Speichern kann im PDF-Format angeboten werden.

Das FdV ermöglicht es dem Nutzer, über Einträge in der Ergebnisliste Berechtigungen zu bearbeiten oder zu löschen.

## 6.2.7.5 Eingerichtete Vertretungen anzeigen

Mit diesem Anwendungsfall kann ein Nutzer eine Liste der Versicherten anzeigen lassen, für die im ePA-Frontend des
Versicherten die Wahrnehmung der Vertretung durch ihn konfiguriert ist ("ich bin Vertreter für"). Es wird dabei nicht
geprüft, ob im Aktenkonto des zu Vertretenden auch tatsächlich eine Berechtigung für den Nutzer vorliegt.

## 6.2.7.6 Bestehende Berechtigungen verwalten

## 6.2.7.6.1 Berechtigung für LEI ändern

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter die Parameter für eine berechtigte LEI
ändern.

Die zum Zugriff auf das Aktenkonto berechtigten LEIs werden mit der übergreifenden Aktivität "Vergebene Berechtigungen
bestimmen" ermittelt.

Wenn die Berechtigungsdauer geändert wird, dann muss ein neuer AuthorizationKey auf Basis eines
Verschlüsselungszertifikates der LEI erzeugt werden. Ein Verschlüsselungszertifikat kann mit der Aktivität "Suchanfrage
Verzeichnisdienst der TI" mit dem Suchkriterium Telematik-ID ermittelt werden. Die Telematik-ID der LEI lässt sich aus
dem Policy Document bestimmen.

Das Policy Document der LEI steht aus der Aktivität "Vergebene Berechtigungen bestimmen" zur Verfügung.

Die Anpassung des AuthorizationKey muss nur erfolgen, wenn die Berechtigungsdauer für die LEI geändert wurde.

Die Dokumentenverwaltung verarbeitet das Policy Document und überschreibt die vorher geltenden Regeln.

## 6.2.7.6.2 Berechtigung für LEI löschen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter einer berechtigten LEI die Berechtigung
entziehen.

Die zum Zugriff auf das Aktenkonto berechtigten LEIs werden mit der übergreifende Aktivität "Vergebene Berechtigungen
bestimmen" ermittelt.

Die Telematik-ID der LEI kann aus dem Policy Document bestimmt werden.

## 6.2.7.6.3 Berechtigung für Vertreter löschen

Mit diesem Anwendungsfall kann ein Versicherter einem berechtigten Vertreter die Berechtigung entziehen. Ferner soll es
einem Vertreter auch möglich sein, sich seine eigene Berechtigung zu entziehen.

Die zum Zugriff auf das Aktenkonto berechtigten Vertreter werden mit der übergreifende Aktivität "Vergebene
Berechtigungen bestimmen" ermittelt.

Die Versicherten-ID für den Vertreter kann aus dem AuthorizationKey bestimmt werden.

## 6.2.7.6.4 Berechtigung für Kostenträger löschen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter dem Kostenträger die Berechtigung
entziehen.

Die zum Zugriff auf das Aktenkonto berechtigten KTR werden mit der übergreifende Aktivität "Vergebene Berechtigungen
bestimmen" ermittelt.

Die Telematik-ID des Kostenträgers kann aus dem Policy Document bestimmt werden.

## 6.2.7.7 Berechtigung für DiGA löschen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter der DiGA die Berechtigung auf die
elektronische Patientenakte entziehen.

Hinweis: Die zum Zugriff auf das Aktenkonto berechtigten DIGA werden mit der übergreifende Aktivität "Vergebene
Berechtigungen bestimmen" ermittelt.

Hinweis: Die Telematik-ID der DiGA kann aus dem Policy Document bestimmt werden.

## 6.2.7.8 Berechtigungen für DiGA vergeben

Mit diesem Anwendungsfall richtet ein Versicherter oder ein berechtigter Vertreter Zugriffsberechtigungen auf das
Aktenkonto für jede einzelne DiGA ein. Die Zugriffrechte einer DiGA sind auf das Einstellen und Aktualisieren von
Dokumenten beschränkt..

Hinweis: Der Name der DiGA entspricht dem displayName aus [gemSpec_VZD#Tabelle 29].

## 6.2.8 Dokumentenverwaltung

## 6.2.8.1 Dokumente einstellen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter Dokumente in die ePA hochladen.

Die für die Dokumente potentiell zugriffsberechtigten LEI werden mittels der übergreifenden Aktivität "Vergebene
Berechtigung bestimmen" ermittelt.

Optional können zusätzlich auch die zugriffsberechtigten Vertreter angezeigt werden. Die Abfrage dient der Kontrolle der
vergebenen Zugriffsberechtigungen durch den Nutzer.

Zugriffsberechtigt sind alle Vertreter und alle LEI mit der Berechtigung für vom Versicherten eingestellte Dokumente.

Für Festlegungen zur Eingabe von Metadaten siehe " ".

Das ePA-Frontend des Versicherten kann eine Prüfung der Metadaten auf Vollständigkeit und Korrektheit durchführen und
den Nutzer bei fehlenden oder falschen Werten zur Korrektur auffordern.

Das ePA-Aktensystem unterstützt nur Dokumente mit bestimmten MIME Types. Die initial zulässigen Typen sind in
[gemSpec_DM_ePA#A_] beschrieben. Die Dokumentenverwaltung prüft jedes Dokument anhand der Metadaten beim Hochladen der
Dokumente und antwortet mit einem Fehler, wenn der Dokumenttyp nicht unterstützt wird.

Das bedeutet, dass Dokumente bis zu einer Größe von 25 MB = 25 * (1024)^2 Byte in die ePA hochgeladen werden. Grundlage
für die Berechnung der Dokumentengröße ist das Dokument ohne Verschlüsselung durch den Dokumentenschlüssel und ohne
Transportcodierung. Größere Dokumente können nicht hochgeladen werden.

Zum Verschlüsseln des Dokuments wird dieses mit einem Dokumentenschlüssel symmetrisch verschlüsselt. Der
Dokumentenschlüssel wird dann symmetrisch mit dem Aktenschlüssel verschlüsselt. Für Vorgaben zum Verschlüsseln eines
Dokuments für das ePA-Aktensystem siehe .

Die Dokumentenschlüssel dürfen nicht persistent gespeichert werden und müssen nach ihrer Verwendung gelöscht werden.

Auf Basis der verschlüsselten Dokumente und den durch den Nutzer für jedes Dokument eingegebenen Metadaten wird
eine Provide And Register Document Set-b Message für die einzustellenden Versichertendokumente erstellt.

Für Nutzungsvorgaben siehe Kapitel .

## 6.2.8.2 Dokumente suchen

Mit diesem Anwendungsfall kann ein Versicherter oder ein berechtigter Vertreter nach Dokumenten oder Dokumentensets im
ePA-Aktensystem auf Basis der XDS-Metadaten der Dokumente suchen. Als Ergebnis der Suchanfrage liefert das ePA-
Aktensystem eine Liste von XDS-Metadaten zu Dokumenten.

Folgende Suchanfragen sollen mindestens möglich sein (ggf. mit zusätzlichem Nachfiltern auf dem FdV):

   - Suche nach allen medizinischen Dokumenten im Aktenkonto
   - Suche nach Ersteller bzw. Einstellendem ($XDSSubmissionSetAuthorPerson, $XDSDocumentEntryAuthorPerson,
     $XDSDocumentEntryAuthorInstitution siehe   und A_17854-*)
   - Suche nach in einem Zeitraum erstellten bzw. eingestellten Dokumenten ($XDSDocumentEntryCeationTimeFrom/To /
     $XDSSubmissionSetSubmissionTimeFrom/To)
   - Suche nach Dokumententitel (siehe [gemSpec_Dokumentenverwaltung#A_17185] und A_17854-*)
   - Suche nach durch LEIs bereitgestellte Dokumente
   - Suche nach Dokumenten mit Kennzeichnung "Versicherteninformation"(siehe [gemSpec_DM_ePA#A_14986])
   - Suche nach durch Krankenkassen bereitgestellte Informationen
   - Suche nach Dokumenten im DocumentEntry.availabilityStatus "Deprecated" oder "Approved"
   - Suche nach durch DiGA bereitgestellten Dokumenten

Das Ergebnis der Suche soll für den Nutzer sortierbar und filterbar dargestellt werden.

Das lokale Speichern kann im PDF Format angeboten werden.

## 6.2.8.3 Dokument herunterladen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter Dokumente aus dem Aktenkonto zum
Anzeigen oder lokalen Speichern herunterladen.

## 6.2.8.4 Dokumente im Aktenkonto löschen

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter Dokumente im Aktenkonto löschen. Die
Dokumente sind damit unwiederbringlich aus dem ePA-Aktensystem entfernt.

## 6.2.9 Protokollverwaltung

## 6.2.9.1 Zugriffsprotokoll einsehen

Bei der Nutzung eines Aktenkontos durch LEI, durch berechtigte Vertreter oder den Aktenkontoinhaber werden Aktivitäten
protokolliert, damit der Aktenkontoinhaber oder ein berechtigter Vertreter diese Aktivitäten nachvollziehen kann. Dazu
zählen Zugriffe auf die Dokumente und seine Metadaten (§ 291a-konformes Zugriffsprotokoll) sowie auch Aktivitäten mit
administrativem Charakter (Verwaltungsprotokoll).

Die verschiedenen Aktivitäten sind in [gemSpec_DM_ePA#A_14505-*] gelistet. 

Die Protokolldaten des § 291a-konformen Zugriffsprotokolls werden im Aktenkonto (Komponente Dokumentenverwaltung)
abgelegt. Die Protokolldaten des Verwaltungsprotokolls werden in verschiedenen Komponenten des ePA-Aktensystems
vorgehalten. Die Daten müssen für eine Anzeige separat abgefragt werden.

Mit diesem Anwendungsfall kann ein Versicherter bzw. ein berechtigter Vertreter die Protokolldaten über die Zugriffe auf
das Aktenkonto des Versicherten einsehen.

Die Protokolleinträge werden im Aktensystem nach Ablauf der in [gemSpec_ePA_FdV#A_19051] beschriebenen Frist gelöscht.

Die Ergebnisse der Abfragen an die Komponenten des ePA-Aktensystems werden vereint.

Die Information eines Protokolleintrages sind in [gemSpec_DM_ePA#A_14471-*] beschrieben. 

Tabelle #: TAB_FdV_155 – Felder im Protokolleintrag

|===========================================================================================================================|
|Protokolldatum                |Bezeichnung in GUI             |Hinweis zur Anzeige           |optional in<br>Standard-<br> |
|                              |                               |                              |Anzeige                      |
|==============================|===============================|==============================|=============================|
|Aufgerufene Operation         |Art des Zugriffs auf das       |DisplayName anzeigen          |                             |
|                              |Aktenkonto                     |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|Datum und Uhrzeit des Zugriffs|Zeitpunkt des Zugriffs         |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|Ergebnis der aufgerufenen     |Ergebnis Zugriff               |0 - erfolgreich<br>1 - nicht  |                             |
|Operation                     |                               |erfolgreich                   |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|UserID                        |Identifier des Nutzers         |                              |x                            |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|UserName                      |Name des Nutzers               |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|ObjectID                      |Identifier des Objektes, auf   |                              |x                            |
|                              |das zugegriffen wurde          |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|ObjectName                    |Bezeichner des Objektes, auf   |                              |                             |
|                              |das zugegriffen wurde          |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|ObjectDetail                  |Details zum zugegriffenen      |                              |                             |
|                              |Objekt                         |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|DeviceID                      |Gerätekennung                  |                              |x                            |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|Home-CommunityID des ePA-     |ID des Aktenanbieters          |                              |x                            |
|Aktensystems                  |                               |                              |                             |
|------------------------------|-------------------------------|------------------------------|-----------------------------|
|Name des Aktenanbieters       |Name des Aktenanbieters        |                              |x                            |
|===========================================================================================================================|

Das FdV kann in der Standard-Anzeige die gemäß TAB_FdV_155 optionalen Felder verbergen. Der Nutzer muss dann die
Möglichkeit haben, sich die verborgenen Felder anzeigen zu lassen.

Das FdV soll in der Standard-Anzeige und in der Erweiterte-Anzeige für die Protokolldaten die Bezeichnung der Felder
sinngemäß zu TAB_FdV_155 verwenden.

Das FdV kann es dem Nutzer über einen Link in der Anzeige ermöglichen, das referenzierte Dokument direkt
herunterzuladen.

Die Protokolldaten sollen für den Nutzer sortierbar und filterbar dargestellt werden. Der Nutzer soll die Protokolldaten
durchsuchen können.

## 6.2.10 Verwaltung eGK

## 6.2.10.1 PIN der eGK ändern

Mit diesem Anwendungsfall kann der Nutzer das Geheimnis der PIN einer eGK ändern.

![img](7136240018193802490.]

Abbildung #: Aktivitätsdiagramm "PIN der eGK ändern"

## 6.2.10.2 PIN der eGK entsperren

Mit diesem Anwendungsfall kann der Nutzer den gesperrten PIN einer eGK mit der PUK entsperren.

![img](551568988126010984.]

Abbildung #: Aktivitätsdiagramm "PIN der eGK entsperren"

## 6.2.11 Geräteverwaltung

## 6.2.11.1 Benachrichtigungsadresse für Geräteautorisierung aktualisieren

Um ein Gerät mit dem FdV für den Zugriff auf ein Aktenkonto zu autorisieren, muss der Nutzer dieses über einen separaten
Benachrichtigungskanal (E-Mail mit Freischalt-Link) bestätigen. Die E-Mail wird an die im Aktenkonto hinterlegte
Benachrichtigungsadresse des Nutzers gesendet.

Für den Aktenkontoinhaber wird die Benachrichtigungsadresse initial im Rahmen der Kontoeröffnung hinterlegt. Für
Vertreter erfolgt die initiale Hinterlegung der Benachrichtigungsadresse während der Vergabe der Zugriffsberechtigung.

Der Anwendungsfall "Benachrichtigungsadresse für Geräteautorisierung aktualisieren" gibt dem Nutzer die Möglichkeit eine
neue Benachrichtigungsadresse im Aktenkonto zu hinterlegen.

## 6.2.11.2 Benachrichtigungsadressen abfragen

Bei der Einrichtung eines Vertreters wird dessen Benachrichtigungsadresse im AS hinterlegt. Die
Schnittstelle GetNotificationInfo wird durch den Versicherten dafür genutzt, diese Benachrichtigungsadresse vom AS
abfragen zu können, insbesondere im Rahmen des Aktenwechsels oder zur Prüfung, ob eine Korrektur
der Benachrichtigungsadresse des Vertreters erforderlich ist.

## 6.3 Realisierung der Leistungen der TI-Plattform

Der Produkttyp ePA-Frontend des Versicherten realisiert die von den Fachanwendungen benötigten Leistungen der TI-
Plattform, die in den fachlichen Anwendungsfällen der ePA genutzt werden. Die durch die TI-Plattform bereitgestellten
Leistungen umfassen einen für die Fachanwendungen einheitlichen Zugriff auf die eGK des Versicherten, Leistungen der PKI
der Telematikinfrastruktur, kryptographische Operationen, etc. die in übergreifenden Spezifikationen der gematik
festgelegt sind. Die Definition der Leistungen der TI-Plattform im ePA-Frontend des Versicherten finden sich in
[gemSpec_Systemprozesse_dezTI].

Das ePA-Frontend des Versicherten verwendet u.a. die in der Tabelle TAB_FdV_177 dargestellten Plattformleistungen.

Tabelle #: TAB_FdV_177 – Verwendete Plattformleistungen

|===========================================================================|
|Kürzel                       |Bezeichnung                                  |
|=============================|=============================================|
|PL_TUC_CARD_CHANGE_PIN       |PIN ändern                                   |
|-----------------------------|---------------------------------------------|
|PL_TUC_CARD_INFORMATION      |Gesammelte Statusinformationen zu einer Karte|
|-----------------------------|---------------------------------------------|
|PL_TUC_CARD_UNBLOCK_PIN      |PIN mit PUK entsperren                       |
|-----------------------------|---------------------------------------------|
|PL_TUC_CARD_VERIFY_PIN       |Benutzer verifizieren                        |
|-----------------------------|---------------------------------------------|
|PL_TUC_GET_CHALLENGE         |Auslesen einer Zufallszahl                   |
|-----------------------------|---------------------------------------------|
|PL_TUC_PKI_VERIFY_CERTIFICATE|Prüfung eines Zertifikats der TI             |
|-----------------------------|---------------------------------------------|
|PL_TUC_SIGN_HASH_nonQES      |mit Karten-Identität signieren               |
|-----------------------------|---------------------------------------------|
|PL_TUC_SYMM_DECIPHER         |Symmetrisch entschlüsseln                    |
|-----------------------------|---------------------------------------------|
|PL_TUC_SYMM_ENCIPHER         |Symmetrisch verschlüsseln                    |
|===========================================================================|

In den folgenden Abschnitten wird festgelegt, wie umgebungsspezifische Operationen an der Schnittstelle zu den
Leistungen der TI-Plattform umgesetzt werden sollen.

## 6.3.1 Transportschnittstelle für Kartenkommandos

Der hier beschriebene Produkttyp ePA-Frontend des Versicherten ist als reines Softwareprodukt konzipiert. Als solches
muss das ePA-Frontend des Versicherten eine Schnittstelle zur eGK über ein Kartenterminal herstellen. Diese
Schnittstelle muss die von den Plattformprozessen erzeugten, kartenverständlichen APDUs an die Karte übertragen und wird
im Folgenden als ENV_TUC_CARD_APDU_TRANSPORT bezeichnet. Neben proprietären Schnittstellentreibern von
Kartenterminalherstellern existieren eine Reihe standardisierter Schnittstellen, die auch von verschiedenen
Betriebssystemen zur Anbindung handelsüblicher Kartenterminals unterstützt werden.

Von der Anforderung A_15501-* darf abgewichen werden, wenn die Umsetzung technisch nicht möglich ist (bspw. durch die
fehlende Unterstützung der NFC-Schnittstelle bei Herstellern mobiler Endgeräte).

Das ePA-Frontend des Versicherten kann ergänzend eine Transportschnittstelle für die Übertragung von SmartCard-APDUs auf
Basis des SICCT-Protokolls, gegen den Standard CCID oder gegen proprietäre Hardwaretreiber eines
Kartenterminalherstellers implementieren.

Es können Kartenterminalvarianten der Sicherheitsklassen 1 (reine Kontaktiereinheit) zum Einsatz kommen. Es sollen
bevorzugt Kartenterminalvarianten der Sicherheitsklassen 2 (Kartenterminal mit eigenem PIN-Pad) oder 3 (PIN-Pad plus
Display) verwendet werden. Zusätzlich ist die Ausstattung des eingesetzten Kartenterminals (Klasse 1, 2 oder 3) mit
einer NFC-Schnittstelle möglich. Das ePA-Frontend des Versicherten muss die von den Varianten gebotenen Features
geeignet nutzen.

Das temporäre Speichern bezieht sich bei der Verwendung eines Kartenterminals der Sicherheitsklasse 1 auf das Verwenden
der PIN über den Anwendungsfall hinaus, für den die PIN-Eingabe erfolgt ist, z.B. Caching während einer Sitzung. Gelangt
das ePA-Frontend des Versicherten bei der Verwendung eines Kartenterminals der Sicherheitsklassen 2 und 3 ggfs. durch
Fehlkonfiguration in Kenntnis der PIN, darf es diese ebenfalls weder temporär noch persistent speichern.

## 6.3.1.1 Kartenterminals der Sicherheitsklasse 1

Kartenterminals der Sicherheitsklasse 1 verfügen über keine Sicherheitsmerkmale, sie sind eine reine Kontaktiereinheit
einer SmartCard. Sämtliche Geheimnis-Eingaben und Hinweistext-Ausgaben müssen über das FdV mittels Bildschirm und
Tastatur/Maus erfolgen.

## 6.3.1.2 Kartenterminals der Sicherheitsklasse 2

Kartenterminals der Sicherheitsklasse 2 verfügen über eine Eingabeschnittstelle zur Eingabe eines Benutzergeheimnisses.
Typischerweise werden Kartenterminals der Sicherheitsklasse 2 in Anwendungsfällen mit Eingabe einer PIN bzw. PUK so
angesteuert, dass das vorbereitete Kartenkommando mit einem Platzhalter des PIN-Geheimnisses an das Kartenterminal
geschickt wird. Das Kartenterminal nimmt die PIN über die Eingabeschnittstelle entgegen, ersetzt den Platzhalter durch
das eingegebene Geheimnis und leitet das Kartenkommando anschließend weiter an die Karte.

## 6.3.1.3 Kartenterminals der Sicherheitsklasse 3

Kartenterminals der Sicherheitsklasse 3 verfügen über eine Eingabeschnittstelle zur Eingabe eines Benutzergeheimnisses
und Ausgabeschnittstelle zur Anzeige kurzer Textmeldungen. Typischerweise werden Kartenterminals der Sicherheitsklasse 3
in Anwendungsfällen mit Eingabe einer PIN bzw. PUK so angesteuert, dass das vorbereitete Kartenkommando mit einem
Platzhalter des PIN-Geheimnisses an das Kartenterminal geschickt wird. Das Kartenterminal nimmt die PIN über die
Eingabeschnittstelle entgegen, ersetzt den Platzhalter durch das eingegebene Geheimnis und leitet das Kartenkommando
anschließend weiter an die Karte.

Während des Wartens auf eine Benutzereingabe kann ein an das Kartenterminal übergebener Text angezeigt werden. Einzelne
Eingaben durch einen Benutzer werden in der Regel durch das Zeichen "*" quittiert. Ebenso besitzen Kartenterminals der
Sicherheitsklasse 3 meist zusätzliche Logik, z.B. Eingaben zu verifizieren (siehe Anforderungen zum Ändern einer PIN
mittels Klasse 1-Kartenterminal). Auf diese Logik soll hier nicht weiter eingegangen werden.

Die Anzeige eines Benutzerhinweises soll den Nutzer informieren zu welchem Zweck eine Eingabe getätigt (z.B. alte PIN,
neue PIN im Anwendungsfall PIN ändern) und welches konkrete Geheimnis abgefragt werden soll (PIN, PUK).

## 6.3.2 Schnittstelle für PIN-Operationen und Anbindung der eGK

Anwendungsfälle zur PIN-Verwaltung, das Login sowie weitere Anwendungsfälle können die Eingabe eines PIN- oder PUK-
Geheimnisses durch den Versicherten erfordern. Der Zugriff auf die eGK erfolgt über die Systemprozesse PL_TUC_CARD_*.
Das FdV als Realisierungsumgebung der Systemprozesse muss ihrerseits die von der Plattform geforderten Schnittstellen
ENV_TUC_CARD_SECRET_INPUT implementieren, um die Kommunikation der Plattform mit dem Nutzer über die Außenschnittstelle
des FdV zu ermöglichen. Die Außenschnittstelle ist in Kapitel "6.3.1 Transportschnittstelle für Kartenkommandos"
beschrieben und umfasst das Kartenterminal, Eingabemedium und Hinweistexte an den Nutzer. Diese kann je nach
Konfiguration an einem Gerät als Kartenterminal der Sicherheitsklasse 3 oder auch eine Kombination aus
Bildschirmausgabe, Kartenterminal-PIN-Pad und/oder Tastatureingabe erfolgen.

## 6.4 Test-App FdV

Für das Zulassungsverfahren des ePA-Frontend des Versicherten muss eine Anwendung (Test-App) mit integriertem ePA-
Frontend des Versicherten bereitgestellt werden. Um einen automatisierten Test für das ePA-Frontend des Versicherten zu
ermöglichen, muss die Test-App zusätzlich ein Testtreiber-Modul beinhalten, welcher die Funktionalitäten der
produktspezifischen Schnittstelle des ePA-Frontend des Versicherten über eine standardisierte Schnittstelle von außen
zugänglich macht und einen Fernzugriff ermöglicht.

![img](8713318036308611941.]

Abbildung #: Test-App mit ePA-Frontend des Versicherten und Testtreiber

Das Testtreiber-Modul darf die Ausgaben des ePA-Frontend des Versicherten gemäß der technischen Schnittstelle
aufarbeiten, aber darf die Inhalte nicht verfälschen.

Der Einsatz des Testtreiber-Moduls ist auf das Zulassungsverfahren in Test-Apps beschränkt und darf nicht in
Wirkbetriebs-Apps genutzt werden.

Die Test-App kann eine GUI anbieten. Diese kann bspw. für die Eingabe der PIN/PUK für die eGK oder die Authentifizierung
gegenüber dem Signaturdienst genutzt werden.

Die Test-App muss Fehler, welche von aufgerufenen Systemen gemeldet werden oder bei der internen Verarbeitung auftreten,
auf produktspezifische Fehler mappen. Der Hersteller muss die Fehler in der Betriebsdokumentation beschreiben und in
einem strukturierten, maschinell verarbeitbarem Dokument übermitteln.

Wenn der Testtreiber einen Eingangsparameter an der Schnittstelle zum ePA-Frontend des Versicherten nicht benötigt, dann
kann der Parameter ignoriert werden.

Alle Operationen beinhalten Parameter mit den notwendigen Informationen für ein Login. Diese sollen für ein implizites
Login genutzt werden, wenn zu der insurantId noch keine Aktensession besteht.

Die Test-App muss bei Implementierung eines an ein ePA-Aktensystem gekoppeltes FdV sicherstellen, dass im Rahmen von
gematik-Tests die Parameter für die Identifikation des zu nutzenden ePA-Aktensystems konfiguriert werden können.

Um Zugriffe aus einer Webanwendung, wie sie durch das AKTOR-Testfrontend zur Verfügung gestellt wird, auf die
Testtreiberschnittstelle zu ermöglichen, werden folgende Schnittstelleneigenschaften benötigt:

Die Test-App kann die Testtreiberschnittstelle so über TLS zur Verfügung stellen, dass ein Zugriff aus Webanwendungen
ermöglicht wird, die selbst über TLS geladen wurden.

Die Test-App kann den Zugriff auf die Testtreiberschnittstelle durch das Setzen von CORS-Headern für den Zugriff aus
Webanwendungen öffnen, die aus einer anderen Origin geladen wurden.

Die konkrete Ausgestaltung der Schnittstellen [gemTestTreiberFdV] ist im Fachportal der gematik und in GitHub vefügbar.

## 7 Informationsmodell

Aktenkonto:

|======================================================================================================|
|Datenfeld                  |Herkunft     |Beschreibung                                                |
|===========================|=============|============================================================|
|Akten-ID (RecordIdentifier)|Konfiguration|beinhaltet Versicherten-ID und Anbieter-ID (homeCommunityId)|
|---------------------------|-------------|------------------------------------------------------------|
|Name des Aktenkontoinhabers|Konfiguration|                                                            |
|---------------------------|-------------|------------------------------------------------------------|
|FQDN des ePA-Aktensystem   |Konfiguration|                                                            |
|======================================================================================================|

Geräte-Daten:

|========================================================================================================================|
|Datenfeld            |Herkunft        |Beschreibung                                                                     |
|=====================|================|=================================================================================|
|Gerätekennung        |Konfiguration   |beinhaltet Gerätenamen und Geräteidentität                                       |
|(DeviceID)           |                |                                                                                 |
|---------------------|----------------|---------------------------------------------------------------------------------|
|Geräteidentität      |Konfiguration   |wird von der Autorisierung beim erstmaligen Aufruf zusammen mit dem              |
|                     |                |DEVICE_UNKNOWN Fehler übermittelt                                                |
|---------------------|----------------|---------------------------------------------------------------------------------|
|Gerätenamen          |Konfiguration   |durch Nutzer festgelegt                                                          |
|========================================================================================================================|

Session-Daten:

|==========================================================================================================================|
|Datenfeld                               |Herkunft                                |Beschreibung                            |
|========================================|========================================|========================================|
|Akten-ID (RecordIdentifier)             |Konfiguration                           |Kennung des Aktenkontos, auf das in der |
|                                        |                                        |Aktensession zugegriffen wird, im Format|
|                                        |                                        |von RecordIdentifier gemäß              |
|                                        |                                        |[gemSpec_DM_ePA#2.2]<br>Die             |
|                                        |                                        |homeCommunityID muss bekannt sein.      |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Status Nutzer<br>(Aktenkontoinhaber oder|                                        |Vergleich Versicherten-ID aus Akten-ID  |
|Vertreter)                              |                                        |mit Versicherten-ID                     |
|                                        |                                        |aus Authentisierungszertifikat des      |
|                                        |                                        |Nutzers                                 |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Authentisierungstoken                   |Komponente Authentisierung<br>          |                                        |
|(AuthenticationAssertion)               |(I_Authentication_Insurant::            |                                        |
|                                        |LoginCreateToken)                       |                                        |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Autorisierungstoken                     |Komponente Autorisierung<br>            |                                        |
|(AuthorizationAssertion)                |(I_Authorization_Insurant::             |                                        |
|                                        |getAuthorizationKey)                    |                                        |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Aktenschlüssel (RecordKey)              |AuthorizationKey                        |entschlüsselter Aktenschlüssel          |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Kontextschlüssel (ContextKey)           |AuthorizationKey                        |entschlüsselter Kontextschlüssel        |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Zustand des Aktenkontos (RecordState)   |Autorisierungstoken<br>Attribut         |                                        |
|                                        |Assertion/AttributeStatement/Attribute  |                                        |
|                                        |mit dem Namen "Zustand des Kontos"      |                                        |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Zeitpunkt der letzten Authentifizierung |Konfiguration                           |                                        |
|durch den Nutzer                        |                                        |                                        |
|----------------------------------------|----------------------------------------|----------------------------------------|
|Liste der vergebenen Berechtigungen     |Aktivität "Vergebene Berechtigungen     |Liste der für alle Berechtigungen       |
|                                        |bestimmen"                              |ausgelesenen AuthorizationKeys und      |
|                                        |                                        |Policy Documents                        |
|==========================================================================================================================|

Nutzer:

|=======================================================================================================================|
|Datenfeld                              |Herkunft                               |Beschreibung                           |
|=======================================|=======================================|=======================================|
|Authentisierungszertifikat des Nutzers |eGK<br>für alternative kryptographische|falls eGK: C.CH.AUT<br>falls           |
|                                       |Versichertenidentität: Signaturdienst  |alternative kryptographische           |
|                                       |                                       |Versichertenidentität: C.CH.AUT_ALT    |
|---------------------------------------|---------------------------------------|---------------------------------------|
|Name des Nutzers                       |Authentisierungszertifikat des Nutzers |                                       |
|---------------------------------------|---------------------------------------|---------------------------------------|
|Versicherten-ID des Nutzers            |Authentisierungszertifikat des Nutzers |                                       |
|---------------------------------------|---------------------------------------|---------------------------------------|
|Benachrichtigungskanal für             |                                       |durch den Nutzer während des Eröffnens |
|Geräteverwaltung (E-Mail)              |                                       |des Aktenkontos angegeben.             |
|=======================================================================================================================|

Berechtigungen:

|========================================================================================================================|
|Datenfeld                              |Herkunft                                                |Beschreibung           |
|=======================================|========================================================|=======================|
|Name des Berechtigten                  |DisplayName aus AuthorizationKey                        |                       |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Kategorie                              |Policy Document                                         |LEI, DiGA, KTR oder    |
|                                       |                                                        |Vertreter              |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|ID                                     |AuthorizationKey / Policy Document                      |für LEI, DiGA oder KTR:|
|                                       |                                                        |Telematik-ID<br>für    |
|                                       |                                                        |Vertreter:             |
|                                       |                                                        |Versicherten-ID        |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Berechtigung gültig bis                |Policy Document                                         |LEI, DiGA, KTR,        |
|                                       |                                                        |Vertreter              |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Berechtigung für LEI                   |PolicyDocument mit "urn:gematik:policy:2.0:<record-id>: |LEI                    |
|                                       |lei:<telematik-id>"                                     |                       |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Berechtigung für KTR                   |Policy Document mit "urn:gematik:policy:2.0:<record-id>:|KTR                    |
|                                       |ktr:<telematik-id>"                                     |                       |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Berechtigung für Vertreter             |Policy Document mit "urn:gematik:policy:2.0:<record-id>:|Vertreter              |
|                                       |rep:<kvnr>"                                             |                       |
|---------------------------------------|--------------------------------------------------------|-----------------------|
|Berechtigung für DiGA                  |Policy Document mit "urn:gematik:policy:2.0:<record-id>:| DiGA                  |
|                                       |diga:<telematik-id>"                                    |                       |
|========================================================================================================================|

## 8 Verteilungssicht

Eine Darstellung der hardwareseitigen Verteilung des Produkttyps bzw. seiner Teilsysteme und der Einbettung in die
physikalische Umgebung wird nicht benötigt.

## 9 Anhang A – Verzeichnisse

## 9.1 Abkürzungenq

|=======================================================================================================================|
|Kürzel               |Erläuterung                                                                                      |
|=====================|=================================================================================================|
|AN                   |Arbeitsnummer                                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------|
|DiGA                 |Digitale Gesundheitsanwendung                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------|
|DSMLv2               | Directory Services Markup Language v2.0                                                         |
|---------------------|-------------------------------------------------------------------------------------------------|
|eGK                  |Elektronische Gesundheitskarte                                                                   |
|---------------------|-------------------------------------------------------------------------------------------------|
|ePA                  |Elektronische Patientenakte                                                                      |
|---------------------|-------------------------------------------------------------------------------------------------|
|FDZ                  |Forschungsdatenzentrum                                                                           |
|---------------------|-------------------------------------------------------------------------------------------------|
|FdV                  |ePA-Frontend des Versicherten                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------|
|FQDN                 |Fully-Qualified Domain Name                                                                      |
|---------------------|-------------------------------------------------------------------------------------------------|
|GdV                  |Gerät des Versicherten                                                                           |
|---------------------|-------------------------------------------------------------------------------------------------|
|IHE                  |Integrating the Healthcare Enterprise                                                            |
|---------------------|-------------------------------------------------------------------------------------------------|
|KTR                  |Kostenträger                                                                                     |
|---------------------|-------------------------------------------------------------------------------------------------|
|KVNR                 |Krankenversichertennummer                                                                        |
|---------------------|-------------------------------------------------------------------------------------------------|
|LE                   |Leistungserbringer                                                                               |
|---------------------|-------------------------------------------------------------------------------------------------|
|LEI                  |Leistungserbringerinstitution                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------|
|LP                   |Lieferpseudonym                                                                                  |
|---------------------|-------------------------------------------------------------------------------------------------|
|MTOM                 |Message Transmission Optimization Mechanism                                                      |
|---------------------|-------------------------------------------------------------------------------------------------|
|NFC                  |Near Field Communication                                                                         |
|---------------------|-------------------------------------------------------------------------------------------------|
|OWASP                |Open Web Application Security Project                                                            |
|---------------------|-------------------------------------------------------------------------------------------------|
|pD                   |pseudonymisierte Dokumente des Versicherten (strukturierte Dokumente, auf welche das             |
|                     |Pseudonymisierungsschema angewendet wurde)                                                       |
|---------------------|-------------------------------------------------------------------------------------------------|
|pDenc                |pseudonymisierte Dokumente, Ende-zu-Ende verschlüsselt für das Forschungsdatenzentrum            |
|---------------------|-------------------------------------------------------------------------------------------------|
|PDF                  |Portable Document Format                                                                         |
|---------------------|-------------------------------------------------------------------------------------------------|
|PIN                  |Personal Identification Number                                                                   |
|---------------------|-------------------------------------------------------------------------------------------------|
|Pseudonymisierungs-  |MIO-, bzw. FHIR-Profil-spezifische Auflistung aller möglichen Elemente, welche in eine pseudonyme|
|schablone,           |Repräsentation übernommen werden können, jeweils definiert als Fhir-Path-Angabe                  |
|Pseudonymisierungs-  |                                                                                                 |
|vorgaben             |                                                                                                 |
|---------------------|-------------------------------------------------------------------------------------------------|
|PUK                  |Personal Unblocking Key                                                                          |
|---------------------|-------------------------------------------------------------------------------------------------|
|SGD                  |Schlüsselgenerierungsdienst                                                                      |
|---------------------|-------------------------------------------------------------------------------------------------|
|SOAP                 |Simple Object Access Protocol                                                                    |
|---------------------|-------------------------------------------------------------------------------------------------|
|TI                   |Telematikinfrastruktur                                                                           |
|---------------------|-------------------------------------------------------------------------------------------------|
|TLS                  |Transport Layer Security                                                                         |
|---------------------|-------------------------------------------------------------------------------------------------|
|TSL                  |Trust-service Status List                                                                        |
|---------------------|-------------------------------------------------------------------------------------------------|
|VST                  |Vertrauensstelle                                                                                 |
|---------------------|-------------------------------------------------------------------------------------------------|
|VZD                  |Verzeichnisdienst der TI                                                                         |
|=======================================================================================================================|

## 9.2 Glossar

|=======================================================================================================================|
|Begriff                            |Erläuterung                                                                        |
|===================================|===================================================================================|
|Funktionsmerkmal                   |Der Begriff beschreibt eine Funktion oder auch einzelne, eine logische Einheit     |
|                                   |bildende Teilfunktionen der TI im Rahmen der funktionalen Zerlegung des Systems.   |
|-----------------------------------|-----------------------------------------------------------------------------------|
|Patienteninformation               |Ist ein durch eine Leistungserbringerinstitution im Aktenkonto bereitgestelltes    |
|                                   |Dokument, welches vorrangig der Information von Versicherten dient. Das Dokument   |
|                                   |wird durch den Leistungserbringer als Versicherteninformation gekennzeichnet.      |
|-----------------------------------|-----------------------------------------------------------------------------------|
|Policy Document                    |Das Policy Document ist ein technisches Dokument. Es enthält die Zugriffsregeln    |
|                                   |eines Berechtigten im Aktenkonto des Versicherten in der Komponente                |
|                                   |"Dokumentenverwaltung". Berechtige der Aktenkontoinhaber, Vertreter oder LEIs.     |
|-----------------------------------|-----------------------------------------------------------------------------------|
|Versicherten-ID                    |Die Versicherten-ID ist der 10-stellige unveränderliche Teil der 30-stelligen      |
|                                   |Krankenversichertennummer (KVNR).                                                  |
|-----------------------------------|-----------------------------------------------------------------------------------|
|Versichertendokument               |Ist ein durch einen Versicherten (Aktenkontoinhaber oder Vertreter) im Aktenkonto  |
|                                   |bereitgestelltes Dokument                                                          |
|-----------------------------------|-----------------------------------------------------------------------------------|
|Versicherteninformation            |siehe Patienteninformation                                                         |
|=======================================================================================================================|

Das Glossar wird als eigenständiges Dokument, vgl. [gemGlossar] zur Verfügung gestellt.

## 9.3 Abbildungsverzeichnis

## 9.4 Tabellenverzeichnis

## 9.5 Referenzierte Dokumente

## 9.5.1 Dokumente der gematik

Die nachfolgende Tabelle enthält die Bezeichnung der in dem vorliegenden Dokument referenzierten Dokumente der gematik
zur Telematikinfrastruktur.

|=======================================================================================================================|
|[Quelle]                                  |Herausgeber: Titel                                                          |
|==========================================|============================================================================|
|[gemGlossar]                              |gematik: Einführung der Gesundheitskarte - Glossar                          |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Aktensystem]                     |gematik: Spezifikation ePA-Aktensystem                                      |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Authentisierung_Vers]            |gematik: Spezifikation Authentisierung des Versicherten ePA                 |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Autorisierung]                   |gematik: Spezifikation Autorisierung ePA                                    |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_DM_ePA]                          |gematik: Datenmodell ePA                                                    |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Dokumentenverwaltung]            |gematik: Spezifikation Dokumentenverwaltung ePA                             |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Krypt]                           |gematik: Übergreifende Spezifikation<br>Verwendung kryptographischer        |
|                                          |Algorithmen in der Telematikinfrastruktur                                   |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_OID]                             |gematik: Spezifikation Festlegung von OIDs                                  |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_OM]                              |gematik: Übergreifende Spezifikation Operations und Maintenance             |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_PKI]                             |gematik: Übergreifende Spezifikation Spezifikation PKI                      |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_SGD_ePA]                         |gematik: Spezifikation Schlüsselgenerierungsdienst ePA                      |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_SigD]                            |gematik: Spezifikation Signaturdienst                                       |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Systemprozesse_dezTI]            |gematik: Spezifikation Systemprozesse der dezentralen TI                    |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_TSL]                             |gematik: Spezifikation TSL-Dienst                                           |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_X_509_TSP]                       |gematik: Spezifikation Trust Service Provider X.509                         |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSpec_Zugangsgateway_Vers]             |gematik: Spezifikation Zugangsgateway des Versicherten ePA                  |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemSysL_ ePA]                            |gematik: Systemspezifisches Konzept ePA                                     |
|------------------------------------------|----------------------------------------------------------------------------|
|[gemTestTreiberFdV]                       |gematik: Testtreiber-Schnittstellen I_FDV und I_FDV_Management<br>          |
|                                          |(src/openapi/testtreiber_fdv.yaml), https://github.com/gematik/api-ePAhttps:|
|                                          |//github.com/gematik/api-ePA                                                |
|------------------------------------------|----------------------------------------------------------------------------|
|[FD_Aufzeichnung_Schema]                  |gematik: researchDataSubmissionTrackingList.json,                           |
|                                          |guideline_researchDataSubmissionTracking.adoc<br>Json-Schema für das        |
|                                          |Dokument zur Aufzeichnung der Freigabe und des Widerrufs von Daten für      |
|                                          |Forschungszwecke, zzgl Anleitung.<br>Version 1.0.1<br>GitHub: [https:       |
|                                          |//github.com/gematik/api-ePA ]https://github.com/gematik/api-ePA  <br>Path: |
|                                          |src/implementation_guides                                                   |
|------------------------------------------|----------------------------------------------------------------------------|
|[FD_Aufzeichnung]                         |gematik: ig-researchDataSubmissionTracking.json<br>Implementation-Guide für |
|                                          |das Dokument 'Aufzeichnungsliste' zur Aufzeichnung der Freigabe und des     |
|                                          |Widerrufs von Daten für Forschungszwecke in der Akte des Versicherten<br>   |
|                                          |Version 1.0.0<br>GitHub: [https://github.com/gematik/api-ePA ]https:        |
|                                          |//github.com/gematik/api-ePA  <br>Path: src/implementation_guides           |
|------------------------------------------|----------------------------------------------------------------------------|
|[IG_MIO]                                  |gematik: Implementation Guides für strukturierte Dokumente<br>GitHub:       |
|                                          |[https://github.com/gematik/api-ePA ]https://github.com/gematik/api-ePA     |
|                                          |<br>Path: src/implementation_guides                                         |
|------------------------------------------|----------------------------------------------------------------------------|
|[I_Authorization_Token_Service]           |gematik: I_Authorization_Insurant.yaml<br>REST-Schnittstelle zur Ausstellung|
|                                          |der Transporttoken für die Freigabe von Dokumenten für Forschungszwecke<br> |
|                                          |Version 1.0.0<br>GitHub: [https://github.com/gematik/api-ePA ]https:        |
|                                          |//github.com/gematik/api-ePA  <br>Path: src/openapi                         |
|=======================================================================================================================|

## 9.5.2 Weitere Dokumente

|=======================================================================================================================|
|[Quelle]                   |Herausgeber (Erscheinungsdatum): Titel                                                     |
|===========================|===========================================================================================|
|[DSML2.0]                  |OASIS: Directory Services Markup Language v2.0<br>December 18, 2001<br>https://www.oasis-  |
|                           |open.org/standardshttps://www.oasis-open.org/standards<br>http://www.oasis-open.           |
|                           |org/committees/dsml/docs/DSMLv2.dochttp://www.oasis-open.org/committees/dsml/docs/DSMLv2.  |
|                           |doc<br>http://oasis-open.org/committees/dsml/erratahttp://oasis-open.                      |
|                           |org/committees/dsml/errata<br>https://www.oasis-open.org/committees/dsml/docs/DSMLv2.      |
|                           |xsdhttps://www.oasis-open.org/committees/dsml/docs/DSMLv2.xsd                              |
|---------------------------|-------------------------------------------------------------------------------------------|
|[ETSI_TS_102_231_V3.1.2]   |ETSI TS 102 231 V3.1.2 (2009-12)<br>Electronic Signatures and Infrastructures (ESI);<br>   |
|                           |Provision of harmonized Trust-service status information                                   |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-APPC]             |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework Supplement,      |
|                           |Advanced Patient Privacy Consents (APPC), Revision 1.2 – Trial Implementation, http://www. |
|                           |ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_APPC.pdfhttp://www.ihe.                  |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_APPC.pdf                                     |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-TF]               |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework, Revision 15.0   |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-TF2a]             |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework, Volume 2a (ITI  |
|                           |TF-2a) – Transactions Part A, Revision 15.0, http://www.ihe.                               |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2a.pdfhttp://www.ihe.                        |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2a.pdf                                       |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-TF2b]             |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework, Volume 2b (ITI  |
|                           |TF-2b) – Transactions Part B, Revision 15.0, http://www.ihe.                               |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2b.pdfhttp://www.ihe.                        |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2b.pdf                                       |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-TF2x]             |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework, Volume 2x (ITI  |
|                           |TF-2x) – Volume 2 Appendices, Revision 15.1, http://www.ihe.                               |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2x.pdfhttp://www.ihe.                        |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_TF_Vol2x.pdf                                       |
|---------------------------|-------------------------------------------------------------------------------------------|
|[IHE-ITI-RMD]              |IHE International (2018): IHE IT Infrastructure (ITI) Technical Framework Supplement,      |
|                           |Remove Metadata and Documents (RMD), Revision 1.2 – Trial Implementation<br>https://www.   |
|                           |ihe.net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_RMD.pdfhttps://www.ihe.                  |
|                           |net/uploadedFiles/Documents/ITI/IHE_ITI_Suppl_RMD.pdf                                      |
|---------------------------|-------------------------------------------------------------------------------------------|
|[MTOM]                     |W3C (2005): SOAP Message Transmission Optimization Mechanism, https://www.w3.org/TR/soap12-|
|                           |mtom/https://www.w3.org/TR/soap12-mtom/                                                    |
|---------------------------|-------------------------------------------------------------------------------------------|
|[OWASP Proactive Control]  |OWASP Top Ten Proactive Controls Project <br>OWASP Proactive Controls For Developers v3.0  |
|                           |<br>https://www.owasp.org/images/b/bc/OWASP_Top_10_Proactive_Controls_V3.pdfhttps://www.   |
|                           |owasp.org/images/b/bc/OWASP_Top_10_Proactive_Controls_V3.pdf                               |
|---------------------------|-------------------------------------------------------------------------------------------|
|[OWASP SAMM Project]       |OWASP SAMM Project<br>https://www.owasp.org/index.                                         |
|                           |php/OWASP_SAMM_Project#tab=Browse_Onlinehttps://www.owasp.org/index.                       |
|                           |php/OWASP_SAMM_Project#tab=Browse_Online                                                   |
|---------------------------|-------------------------------------------------------------------------------------------|
|[OWASPMobileTop10]         |OWASP Mobile Security Project: Top 10 Mobile Risks<br>https://owasp.org/www-project-mobile-|
|                           |top-10/https://owasp.org/www-project-mobile-top-10/                                        |
|---------------------------|-------------------------------------------------------------------------------------------|
|[OWASP MASVS]              |OWASP Mobile Application Security Verification Service<br>https://owasp.org/www-chapter-   |
|                           |geneva/assets/slides/OWASP_Geneva-Chapter_Meeting-20161212_Jeremy_Matos-MASVS.pdfhttps:    |
|                           |//owasp.org/www-chapter-geneva/assets/slides/OWASP_Geneva-Chapter_Meeting-                 |
|                           |20161212_Jeremy_Matos-MASVS.pdf                                                            |
|---------------------------|-------------------------------------------------------------------------------------------|
|[OWASP TTMC]               |OWASP Mobile Security Project<br>https://owasp.org/www-project-mobile-security/https:      |
|                           |//owasp.org/www-project-mobile-security/                                                   |
|---------------------------|-------------------------------------------------------------------------------------------|
|[RFC6960]                  |RFC 6960 (Juni 2013): X.509 Internet Public Key Infrastructure<br>Online Certificate Status|
|                           |Protocol - OCSP<br>https://tools.ietf.org/html/rfc6960https://tools.ietf.org/html/rfc6960  |
|---------------------------|-------------------------------------------------------------------------------------------|
|[vesta]                    |Zentrales Interoperabilitätsverzeichnis des deutschen Gesundheitswesens<br>https://www.    |
|                           |vesta-gematik.de/https://www.vesta-gematik.de/                                             |
|---------------------------|-------------------------------------------------------------------------------------------|
|[WSIBP]                    |Web-Services Interoperability Consortium (2010): WS-I Basic Profile V2.0 (final material), |
|                           |<br>http://ws-i.org/Profiles/BasicProfile-2.0-2010-11-09.htmlhttp://ws-i.                  |
|                           |org/Profiles/BasicProfile-2.0-2010-11-09.html                                              |
|---------------------------|-------------------------------------------------------------------------------------------|
|[XMLEnc-1.1]               |XML Encryption Syntax and Processing, W3C Recommendation<br>11 April 2013, http://www.w3.  |
|                           |org/TR/xmlenc-core1/http://www.w3.org/TR/xmlenc-core1/                                     |
|---------------------------|-------------------------------------------------------------------------------------------|
|[NGP]                      |Schnittstelle des Nationalen Gesundheitsportal (gesund.bund.de)<br>gemäß search.gesund.    |
|                           |bund.de/documentation/gematik/                                                             |
|---------------------------|-------------------------------------------------------------------------------------------|
|[I_VST]                    |"Vertrauensstelle DATRAV<br>Pseudonymisierungskonzept zur<br>Datenübertragung im Rahmen der|
|                           |<br>Datenfreigabe aus der elektronischen<br>Patientenakte (ePA Lieferpseudonym)"<br>Robert |
|                           |Koch-Institut<br>Version 1.5<br>14.04.2022                                                 |
|---------------------------|-------------------------------------------------------------------------------------------|
|[I_FDZ]                    |"Forschungsdatenzentrum - Schnittstellenkonzept zur Datenfreigabe ePA",<br>Bundesamt für   |
|                           |Arzneimittel und Medizinprodukte<br>Version 1.0,<br>xxx.04.2022                            |
|---------------------------|-------------------------------------------------------------------------------------------|
|[rfc7515]                  |"JSON Web Signature (JWS)"<br>RFC 7515<br>IETF<br>Mai 2015                                 |
|---------------------------|-------------------------------------------------------------------------------------------|
|[rfc7519]                  |"JSON Web Token (JWT)"<br>RFC 7519<br>IETF<br>Mai 2015                                     |
|---------------------------|-------------------------------------------------------------------------------------------|
|[rfc4122]                  |"A Universally Unique Identifier (UUID) URN Namespace"<br>RFC 4122<br>IETF<br>Julli 2005   |
|=======================================================================================================================|

